{"version":3,"file":"index.js","sources":["../../src/GrowthBookReact.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport * as React from \"react\";\nimport type {\n  Experiment,\n  Result,\n  FeatureResult,\n  JSONValue,\n  FeatureDefinition,\n  Context,\n  WidenPrimitives,\n} from \"@growthbook/growthbook\";\nimport { GrowthBook } from \"@growthbook/growthbook\";\n\nexport type GrowthBookContextValue = {\n  growthbook: GrowthBook;\n};\nexport interface WithRunExperimentProps {\n  runExperiment: <T>(exp: Experiment<T>) => Result<T>;\n}\n/** @deprecated */\nexport type GrowthBookSSRData = {\n  attributes: Record<string, any>;\n  features: Record<string, FeatureDefinition>;\n};\n\nexport const GrowthBookContext = React.createContext<GrowthBookContextValue>(\n  {} as GrowthBookContextValue\n);\n\n/** @deprecated */\nexport async function getGrowthBookSSRData(\n  context: Context\n): Promise<GrowthBookSSRData> {\n  // Server-side GrowthBook instance\n  const gb = new GrowthBook({\n    ...context,\n  });\n\n  // Load feature flags from network if needed\n  if (context.clientKey) {\n    await gb.loadFeatures();\n  }\n\n  const data: GrowthBookSSRData = {\n    attributes: gb.getAttributes(),\n    features: gb.getFeatures(),\n  };\n  gb.destroy();\n\n  return data;\n}\n\n/** @deprecated */\nexport function useGrowthBookSSR(data: GrowthBookSSRData) {\n  const gb = useGrowthBook();\n\n  // Only do this once to avoid infinite loops\n  const isFirst = React.useRef(true);\n  if (gb && isFirst.current) {\n    gb.setFeatures(data.features);\n    gb.setAttributes(data.attributes);\n    isFirst.current = false;\n  }\n}\n\nexport function useExperiment<T>(exp: Experiment<T>): Result<T> {\n  const { growthbook } = React.useContext(GrowthBookContext);\n  return growthbook.run(exp);\n}\n\nexport function useFeature<T extends JSONValue = any>(\n  id: string\n): FeatureResult<T | null> {\n  const growthbook = useGrowthBook();\n  return growthbook.evalFeature<T>(id);\n}\n\nexport function useFeatureIsOn<\n  AppFeatures extends Record<string, any> = Record<string, any>\n>(id: string & keyof AppFeatures): boolean {\n  const growthbook = useGrowthBook<AppFeatures>();\n  return growthbook.isOn(id);\n}\n\nexport function useFeatureValue<T extends JSONValue = any>(\n  id: string,\n  fallback: T\n): WidenPrimitives<T> {\n  const growthbook = useGrowthBook();\n  return growthbook.getFeatureValue(id, fallback);\n}\n\nexport function useGrowthBook<\n  AppFeatures extends Record<string, any> = Record<string, any>\n>(): GrowthBook<AppFeatures> {\n  const { growthbook } = React.useContext(GrowthBookContext);\n\n  if (!growthbook) {\n    throw new Error(\"Missing or invalid GrowthBookProvider\");\n  }\n\n  return growthbook as GrowthBook<AppFeatures>;\n}\n\nexport function FeaturesReady({\n  children,\n  timeout,\n  fallback,\n}: {\n  children: React.ReactNode;\n  timeout?: number;\n  fallback?: React.ReactNode;\n}) {\n  const gb = useGrowthBook();\n  const [hitTimeout, setHitTimeout] = React.useState(false);\n  const ready = gb ? gb.ready : false;\n  React.useEffect(() => {\n    if (timeout && !ready) {\n      const timer = setTimeout(() => {\n        gb &&\n          gb.log(\"FeaturesReady timed out waiting for features to load\", {\n            timeout,\n          });\n        setHitTimeout(true);\n      }, timeout);\n      return () => clearTimeout(timer);\n    }\n  }, [timeout, ready, gb]);\n\n  return <>{ready || hitTimeout ? children : fallback || null}</>;\n}\n\nexport function IfFeatureEnabled({\n  children,\n  feature,\n}: {\n  children: React.ReactNode;\n  feature: string;\n}) {\n  return useFeature(feature).on ? <>{children}</> : null;\n}\n\nexport function FeatureString(props: { default: string; feature: string }) {\n  const value = useFeature(props.feature).value;\n\n  if (value !== null) {\n    return <>{value}</>;\n  }\n\n  return <>{props.default}</>;\n}\n\nexport const withRunExperiment = <P extends WithRunExperimentProps>(\n  Component: React.ComponentType<P>\n): React.ComponentType<Omit<P, keyof WithRunExperimentProps>> => {\n  // eslint-disable-next-line\n  const withRunExperimentWrapper = (props: any): JSX.Element => (\n    <GrowthBookContext.Consumer>\n      {({ growthbook }): JSX.Element => {\n        return (\n          <Component\n            {...(props as P)}\n            runExperiment={(exp) => growthbook.run(exp)}\n          />\n        );\n      }}\n    </GrowthBookContext.Consumer>\n  );\n  return withRunExperimentWrapper;\n};\nwithRunExperiment.displayName = \"WithRunExperiment\";\n\nexport const GrowthBookProvider: React.FC<\n  React.PropsWithChildren<{\n    growthbook: GrowthBook;\n  }>\n> = ({ children, growthbook }) => {\n  // Tell growthbook how to re-render our app (for dev mode integration)\n  // eslint-disable-next-line\n  const [_, setRenderCount] = React.useState(0);\n  React.useEffect(() => {\n    if (!growthbook || !growthbook.setRenderer) return;\n\n    growthbook.setRenderer(() => {\n      setRenderCount((v) => v + 1);\n    });\n    return () => {\n      growthbook.setRenderer(() => {\n        // do nothing\n      });\n    };\n  }, [growthbook]);\n\n  return (\n    <GrowthBookContext.Provider\n      value={{\n        growthbook,\n      }}\n    >\n      {children}\n    </GrowthBookContext.Provider>\n  );\n};\n"],"names":["GrowthBookContext","React","createContext","getGrowthBookSSRData","context","gb","GrowthBook","clientKey","loadFeatures","data","attributes","getAttributes","features","getFeatures","destroy","useGrowthBookSSR","useGrowthBook","isFirst","useRef","current","setFeatures","setAttributes","useExperiment","exp","growthbook","useContext","run","useFeature","id","evalFeature","useFeatureIsOn","isOn","useFeatureValue","fallback","getFeatureValue","Error","FeaturesReady","children","timeout","hitTimeout","setHitTimeout","useState","ready","useEffect","timer","setTimeout","log","clearTimeout","IfFeatureEnabled","feature","on","FeatureString","props","value","default","withRunExperiment","Component","withRunExperimentWrapper","displayName","GrowthBookProvider","_","setRenderCount","setRenderer","v"],"mappings":"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"}