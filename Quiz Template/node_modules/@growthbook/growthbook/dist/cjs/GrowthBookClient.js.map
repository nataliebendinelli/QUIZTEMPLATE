{"version":3,"file":"GrowthBookClient.js","names":["SDK_VERSION","loadSDKVersion","GrowthBookClient","constructor","options","version","_options","debug","ready","_features","_experiments","log","bind","plugins","plugin","setPayload","payload","_payload","data","decryptPayload","decryptionKey","_decryptedPayload","features","experiments","savedGroups","initSync","encryptedExperiments","encryptedFeatures","Error","startStreaming","init","cacheSettings","configureCache","success","source","res","_refresh","allowStale","refreshFeatures","getApiInfo","getApiHosts","apiHost","getClientKey","clientKey","getPayload","getFeatures","getDecryptedPayload","timeout","skipCache","streaming","instance","disableCache","backgroundSync","getGlobalAttributes","globalAttributes","setGlobalAttributes","attributes","destroy","_destroyed","unsubscribe","undefined","isDestroyed","setEventLogger","logger","eventLogger","logEvent","eventName","properties","userContext","ctx","_getEvalContext","user","runInlineExperiment","experiment","result","runExperiment","global","_getGlobalContext","stack","evaluatedFeatures","Set","enabled","qaMode","forcedFeatureValues","forcedVariations","trackingCallback","onFeatureUsage","isOn","key","evalFeature","on","isOff","off","getFeatureValue","defaultValue","value","id","_evalFeature","msg","console","setTrackingCallback","callback","applyStickyBuckets","partialContext","stickyBucketService","stickyBucketAssignmentDocs","getAllStickyBucketAssignmentDocs","saveStickyBucketAssignmentDoc","doc","saveAssignments","createScopedInstance","userPlugins","UserScopedGrowthBook","gb","_gb","_userContext","logs","trackedExperiments","trackedFeatureUsage","devLogs","enableDevMode","push","timestamp","Date","now","toString","logType","cb","setURL","url","updateAttributes","setAttributeOverrides","overrides","attributeOverrides","setForcedVariations","vars","setForcedFeatures","map","getUserContext","getVersion","inDevMode"],"sources":["../../src/GrowthBookClient.ts"],"sourcesContent":["import type {\n  ApiHost,\n  Attributes,\n  AutoExperiment,\n  ClientKey,\n  ClientOptions,\n  EvalContext,\n  EventLogger,\n  EventProperties,\n  Experiment,\n  FeatureApiResponse,\n  FeatureDefinitions,\n  FeatureResult,\n  GlobalContext,\n  InitOptions,\n  InitResponse,\n  InitSyncOptions,\n  LogUnion,\n  Plugin,\n  RefreshFeaturesOptions,\n  Result,\n  TrackingCallback,\n  TrackingCallbackWithUser,\n  UserContext,\n  WidenPrimitives,\n} from \"./types/growthbook\";\nimport { loadSDKVersion } from \"./util\";\nimport {\n  configureCache,\n  refreshFeatures,\n  startStreaming,\n  unsubscribe,\n} from \"./feature-repository\";\nimport {\n  decryptPayload,\n  evalFeature as _evalFeature,\n  getAllStickyBucketAssignmentDocs,\n  getApiHosts,\n  runExperiment,\n} from \"./core\";\nimport { StickyBucketService } from \"./sticky-bucket-service\";\n\nconst SDK_VERSION = loadSDKVersion();\n\nexport class GrowthBookClient<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  AppFeatures extends Record<string, any> = Record<string, any>\n> {\n  public debug: boolean;\n  public ready: boolean;\n  public version: string;\n\n  // Properties and methods that start with \"_\" are mangled by Terser (saves ~150 bytes)\n  private _options: ClientOptions;\n\n  private _features: FeatureDefinitions;\n  private _experiments: AutoExperiment[];\n  private _payload: FeatureApiResponse | undefined;\n  private _decryptedPayload: FeatureApiResponse | undefined;\n  private _destroyed?: boolean;\n\n  constructor(options?: ClientOptions) {\n    options = options || {};\n    // These properties are all initialized in the constructor instead of above\n    // This saves ~80 bytes in the final output\n    this.version = SDK_VERSION;\n    this._options = options;\n    this.debug = !!options.debug;\n    this.ready = false;\n    this._features = {};\n    this._experiments = [];\n\n    this.log = this.log.bind(this);\n\n    if (options.plugins) {\n      for (const plugin of options.plugins) {\n        plugin(this);\n      }\n    }\n  }\n\n  public async setPayload(payload: FeatureApiResponse): Promise<void> {\n    this._payload = payload;\n    const data = await decryptPayload(payload, this._options.decryptionKey);\n    this._decryptedPayload = data;\n    if (data.features) {\n      this._features = data.features;\n    }\n    if (data.experiments) {\n      this._experiments = data.experiments;\n    }\n    if (data.savedGroups) {\n      this._options.savedGroups = data.savedGroups;\n    }\n    this.ready = true;\n  }\n\n  public initSync(options: InitSyncOptions): GrowthBookClient<AppFeatures> {\n    const payload = options.payload;\n\n    if (payload.encryptedExperiments || payload.encryptedFeatures) {\n      throw new Error(\"initSync does not support encrypted payloads\");\n    }\n\n    this._payload = payload;\n    this._decryptedPayload = payload;\n    if (payload.features) {\n      this._features = payload.features;\n    }\n    if (payload.experiments) {\n      this._experiments = payload.experiments;\n    }\n\n    this.ready = true;\n\n    startStreaming(this, options);\n\n    return this;\n  }\n\n  public async init(options?: InitOptions): Promise<InitResponse> {\n    options = options || {};\n\n    if (options.cacheSettings) {\n      configureCache(options.cacheSettings);\n    }\n\n    if (options.payload) {\n      await this.setPayload(options.payload);\n      startStreaming(this, options);\n      return {\n        success: true,\n        source: \"init\",\n      };\n    } else {\n      const { data, ...res } = await this._refresh({\n        ...options,\n        allowStale: true,\n      });\n      startStreaming(this, options);\n      await this.setPayload(data || {});\n      return res;\n    }\n  }\n\n  public async refreshFeatures(\n    options?: RefreshFeaturesOptions\n  ): Promise<void> {\n    const res = await this._refresh({\n      ...(options || {}),\n      allowStale: false,\n    });\n    if (res.data) {\n      await this.setPayload(res.data);\n    }\n  }\n\n  public getApiInfo(): [ApiHost, ClientKey] {\n    return [this.getApiHosts().apiHost, this.getClientKey()];\n  }\n  public getApiHosts() {\n    return getApiHosts(this._options);\n  }\n  public getClientKey(): string {\n    return this._options.clientKey || \"\";\n  }\n  public getPayload(): FeatureApiResponse {\n    return (\n      this._payload || {\n        features: this.getFeatures(),\n        experiments: this._experiments || [],\n      }\n    );\n  }\n  public getDecryptedPayload(): FeatureApiResponse {\n    return this._decryptedPayload || this.getPayload();\n  }\n\n  private async _refresh({\n    timeout,\n    skipCache,\n    allowStale,\n    streaming,\n  }: RefreshFeaturesOptions & {\n    allowStale?: boolean;\n    streaming?: boolean;\n  }) {\n    if (!this._options.clientKey) {\n      throw new Error(\"Missing clientKey\");\n    }\n    // Trigger refresh in feature repository\n    return refreshFeatures({\n      instance: this,\n      timeout,\n      skipCache: skipCache || this._options.disableCache,\n      allowStale,\n      backgroundSync: streaming ?? true,\n    });\n  }\n\n  public getFeatures() {\n    return this._features || {};\n  }\n\n  public getGlobalAttributes(): Attributes {\n    return this._options.globalAttributes || {};\n  }\n  public setGlobalAttributes(attributes: Attributes) {\n    this._options.globalAttributes = attributes;\n  }\n\n  public destroy() {\n    this._destroyed = true;\n    unsubscribe(this);\n\n    // Release references to save memory\n    this._features = {};\n    this._experiments = [];\n    this._decryptedPayload = undefined;\n    this._payload = undefined;\n    this._options = {};\n  }\n\n  public isDestroyed() {\n    return !!this._destroyed;\n  }\n\n  public setEventLogger(logger: EventLogger) {\n    this._options.eventLogger = logger;\n  }\n\n  public logEvent(\n    eventName: string,\n    properties: EventProperties,\n    userContext: UserContext\n  ) {\n    if (this._options.eventLogger) {\n      const ctx = this._getEvalContext(userContext);\n      this._options.eventLogger(eventName, properties, ctx.user);\n    }\n  }\n\n  public runInlineExperiment<T>(\n    experiment: Experiment<T>,\n    userContext: UserContext\n  ): Result<T> {\n    const { result } = runExperiment(\n      experiment,\n      null,\n      this._getEvalContext(userContext)\n    );\n    return result;\n  }\n\n  private _getEvalContext(userContext: UserContext): EvalContext {\n    if (this._options.globalAttributes) {\n      userContext = {\n        ...userContext,\n        attributes: {\n          ...this._options.globalAttributes,\n          ...userContext.attributes,\n        },\n      };\n    }\n\n    return {\n      user: userContext,\n      global: this._getGlobalContext(),\n      stack: {\n        evaluatedFeatures: new Set(),\n      },\n    };\n  }\n\n  private _getGlobalContext(): GlobalContext {\n    return {\n      features: this._features,\n      experiments: this._experiments,\n      log: this.log,\n      enabled: this._options.enabled,\n      qaMode: this._options.qaMode,\n      savedGroups: this._options.savedGroups,\n      forcedFeatureValues: this._options.forcedFeatureValues,\n      forcedVariations: this._options.forcedVariations,\n      trackingCallback: this._options.trackingCallback,\n      onFeatureUsage: this._options.onFeatureUsage,\n    };\n  }\n\n  public isOn<K extends string & keyof AppFeatures = string>(\n    key: K,\n    userContext: UserContext\n  ): boolean {\n    return this.evalFeature(key, userContext).on;\n  }\n\n  public isOff<K extends string & keyof AppFeatures = string>(\n    key: K,\n    userContext: UserContext\n  ): boolean {\n    return this.evalFeature(key, userContext).off;\n  }\n\n  public getFeatureValue<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(key: K, defaultValue: V, userContext: UserContext): WidenPrimitives<V> {\n    const value = this.evalFeature<WidenPrimitives<V>, K>(key, userContext)\n      .value;\n    return value === null ? (defaultValue as WidenPrimitives<V>) : value;\n  }\n\n  public evalFeature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K, userContext: UserContext): FeatureResult<V | null> {\n    return _evalFeature(id, this._getEvalContext(userContext));\n  }\n\n  log(msg: string, ctx: Record<string, unknown>) {\n    if (!this.debug) return;\n    if (this._options.log) this._options.log(msg, ctx);\n    else console.log(msg, ctx);\n  }\n\n  public setTrackingCallback(callback: TrackingCallbackWithUser) {\n    this._options.trackingCallback = callback;\n  }\n\n  public async applyStickyBuckets(\n    partialContext: Omit<\n      UserContext,\n      \"stickyBucketService\" | \"stickyBucketAssignmentDocs\"\n    >,\n    stickyBucketService: StickyBucketService\n  ): Promise<UserContext> {\n    const ctx = this._getEvalContext(partialContext);\n\n    const stickyBucketAssignmentDocs = await getAllStickyBucketAssignmentDocs(\n      ctx,\n      stickyBucketService\n    );\n\n    return {\n      ...partialContext,\n      stickyBucketAssignmentDocs,\n      saveStickyBucketAssignmentDoc: (doc) =>\n        stickyBucketService.saveAssignments(doc),\n    };\n  }\n\n  public createScopedInstance(\n    userContext: UserContext,\n    userPlugins?: Plugin[]\n  ) {\n    return new UserScopedGrowthBook(this, userContext, [\n      ...(this._options.plugins || []),\n      ...(userPlugins || []),\n    ]);\n  }\n}\n\nexport class UserScopedGrowthBook<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  AppFeatures extends Record<string, any> = Record<string, any>\n> {\n  private _gb: GrowthBookClient;\n  private _userContext: UserContext;\n  public logs: Array<LogUnion>;\n\n  constructor(\n    gb: GrowthBookClient<AppFeatures>,\n    userContext: UserContext,\n    plugins?: Plugin[]\n  ) {\n    this._gb = gb;\n    this._userContext = userContext;\n    this.logs = [];\n\n    this._userContext.trackedExperiments =\n      this._userContext.trackedExperiments || new Set();\n    this._userContext.trackedFeatureUsage =\n      this._userContext.trackedFeatureUsage || {};\n    this._userContext.devLogs = this.logs;\n\n    if (plugins) {\n      for (const plugin of plugins) {\n        plugin(this);\n      }\n    }\n  }\n\n  public runInlineExperiment<T>(experiment: Experiment<T>): Result<T> {\n    return this._gb.runInlineExperiment(experiment, this._userContext);\n  }\n\n  public isOn<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this._gb.isOn(key, this._userContext);\n  }\n\n  public isOff<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this._gb.isOff(key, this._userContext);\n  }\n\n  public getFeatureValue<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(key: K, defaultValue: V): WidenPrimitives<V> {\n    return this._gb.getFeatureValue(key, defaultValue, this._userContext);\n  }\n\n  public evalFeature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K): FeatureResult<V | null> {\n    return this._gb.evalFeature(id, this._userContext);\n  }\n\n  public logEvent(eventName: string, properties?: EventProperties) {\n    if (this._userContext.enableDevMode) {\n      this.logs.push({\n        eventName,\n        properties,\n        timestamp: Date.now().toString(),\n        logType: \"event\",\n      });\n    }\n    this._gb.logEvent(eventName, properties || {}, this._userContext);\n  }\n\n  public setTrackingCallback(cb: TrackingCallback) {\n    this._userContext.trackingCallback = cb;\n  }\n  public getApiInfo(): [ApiHost, ClientKey] {\n    return this._gb.getApiInfo();\n  }\n  public getClientKey() {\n    return this._gb.getClientKey();\n  }\n  public setURL(url: string) {\n    this._userContext.url = url;\n  }\n  public updateAttributes(attributes: Attributes) {\n    this._userContext.attributes = {\n      ...this._userContext.attributes,\n      ...attributes,\n    };\n  }\n  public setAttributeOverrides(overrides: Attributes) {\n    this._userContext.attributeOverrides = overrides;\n  }\n  public async setForcedVariations(vars: Record<string, number>) {\n    this._userContext.forcedVariations = vars || {};\n  }\n  // eslint-disable-next-line\n  public setForcedFeatures(map: Map<string, any>) {\n    this._userContext.forcedFeatureValues = map;\n  }\n  public getUserContext() {\n    return this._userContext;\n  }\n  public getVersion() {\n    return SDK_VERSION;\n  }\n  public getDecryptedPayload() {\n    return this._gb.getDecryptedPayload();\n  }\n  public inDevMode(): boolean {\n    return !!this._userContext.enableDevMode;\n  }\n}\n"],"mappings":"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"}