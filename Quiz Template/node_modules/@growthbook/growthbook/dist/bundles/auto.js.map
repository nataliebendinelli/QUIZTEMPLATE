{"version":3,"file":"auto.js","sources":["../../../../node_modules/js-cookie/dist/js.cookie.mjs","../../../../node_modules/dom-mutator/dist/dom-mutator.esm.js","../../src/util.ts","../../src/feature-repository.ts","../../src/mongrule.ts","../../src/core.ts","../../src/GrowthBook.ts","../../src/sticky-bucket-service.ts","../../src/plugins/auto-attributes.ts","../../src/plugins/growthbook-tracking.ts","../../src/plugins/third-party-tracking.ts","../../src/auto-wrapper.ts"],"sourcesContent":["/*! js-cookie v3.0.5 | MIT */\n/* eslint-disable no-var */\nfunction assign (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      target[key] = source[key];\n    }\n  }\n  return target\n}\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\nvar defaultConverter = {\n  read: function (value) {\n    if (value[0] === '\"') {\n      value = value.slice(1, -1);\n    }\n    return value.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent)\n  },\n  write: function (value) {\n    return encodeURIComponent(value).replace(\n      /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,\n      decodeURIComponent\n    )\n  }\n};\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\n\nfunction init (converter, defaultAttributes) {\n  function set (name, value, attributes) {\n    if (typeof document === 'undefined') {\n      return\n    }\n\n    attributes = assign({}, defaultAttributes, attributes);\n\n    if (typeof attributes.expires === 'number') {\n      attributes.expires = new Date(Date.now() + attributes.expires * 864e5);\n    }\n    if (attributes.expires) {\n      attributes.expires = attributes.expires.toUTCString();\n    }\n\n    name = encodeURIComponent(name)\n      .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n      .replace(/[()]/g, escape);\n\n    var stringifiedAttributes = '';\n    for (var attributeName in attributes) {\n      if (!attributes[attributeName]) {\n        continue\n      }\n\n      stringifiedAttributes += '; ' + attributeName;\n\n      if (attributes[attributeName] === true) {\n        continue\n      }\n\n      // Considers RFC 6265 section 5.2:\n      // ...\n      // 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n      //     character:\n      // Consume the characters of the unparsed-attributes up to,\n      // not including, the first %x3B (\";\") character.\n      // ...\n      stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n    }\n\n    return (document.cookie =\n      name + '=' + converter.write(value, name) + stringifiedAttributes)\n  }\n\n  function get (name) {\n    if (typeof document === 'undefined' || (arguments.length && !name)) {\n      return\n    }\n\n    // To prevent the for loop in the first place assign an empty array\n    // in case there are no cookies at all.\n    var cookies = document.cookie ? document.cookie.split('; ') : [];\n    var jar = {};\n    for (var i = 0; i < cookies.length; i++) {\n      var parts = cookies[i].split('=');\n      var value = parts.slice(1).join('=');\n\n      try {\n        var found = decodeURIComponent(parts[0]);\n        jar[found] = converter.read(value, found);\n\n        if (name === found) {\n          break\n        }\n      } catch (e) {}\n    }\n\n    return name ? jar[name] : jar\n  }\n\n  return Object.create(\n    {\n      set,\n      get,\n      remove: function (name, attributes) {\n        set(\n          name,\n          '',\n          assign({}, attributes, {\n            expires: -1\n          })\n        );\n      },\n      withAttributes: function (attributes) {\n        return init(this.converter, assign({}, this.attributes, attributes))\n      },\n      withConverter: function (converter) {\n        return init(assign({}, this.converter, converter), this.attributes)\n      }\n    },\n    {\n      attributes: { value: Object.freeze(defaultAttributes) },\n      converter: { value: Object.freeze(converter) }\n    }\n  )\n}\n\nvar api = init(defaultConverter, { path: '/' });\n/* eslint-enable no-var */\n\nexport { api as default };\n","var validAttributeName = /^[a-zA-Z:_][a-zA-Z0-9:_.-]*$/;\nvar nullController = {\n  revert: function revert() {}\n};\nvar elements = /*#__PURE__*/new Map();\nvar mutations = /*#__PURE__*/new Set();\n\nfunction getObserverInit(attr) {\n  return attr === 'html' ? {\n    childList: true,\n    subtree: true,\n    attributes: true,\n    characterData: true\n  } : {\n    childList: false,\n    subtree: false,\n    attributes: true,\n    attributeFilter: [attr]\n  };\n}\n\nfunction getElementRecord(element) {\n  var record = elements.get(element);\n\n  if (!record) {\n    record = {\n      element: element,\n      attributes: {}\n    };\n    elements.set(element, record);\n  }\n\n  return record;\n}\n\nfunction createElementPropertyRecord(el, attr, getCurrentValue, setValue, mutationRunner) {\n  var currentValue = getCurrentValue(el);\n  var record = {\n    isDirty: false,\n    originalValue: currentValue,\n    virtualValue: currentValue,\n    mutations: [],\n    el: el,\n    _positionTimeout: null,\n    observer: new MutationObserver(function () {\n      // enact a 1 second timeout that blocks subsequent firing of the\n      // observer until the timeout is complete. This will prevent multiple\n      // mutations from firing in quick succession, which can cause the\n      // mutation to be reverted before the DOM has a chance to update.\n      if (attr === 'position' && record._positionTimeout) return;else if (attr === 'position') record._positionTimeout = setTimeout(function () {\n        record._positionTimeout = null;\n      }, 1000);\n      var currentValue = getCurrentValue(el);\n      if (attr === 'position' && currentValue.parentNode === record.virtualValue.parentNode && currentValue.insertBeforeNode === record.virtualValue.insertBeforeNode) return;\n      if (currentValue === record.virtualValue) return;\n      record.originalValue = currentValue;\n      mutationRunner(record);\n    }),\n    mutationRunner: mutationRunner,\n    setValue: setValue,\n    getCurrentValue: getCurrentValue\n  };\n\n  if (attr === 'position' && el.parentNode) {\n    record.observer.observe(el.parentNode, {\n      childList: true,\n      subtree: true,\n      attributes: false,\n      characterData: false\n    });\n  } else {\n    record.observer.observe(el, getObserverInit(attr));\n  }\n\n  return record;\n}\n\nfunction queueIfNeeded(val, record) {\n  var currentVal = record.getCurrentValue(record.el);\n  record.virtualValue = val;\n\n  if (val && typeof val !== 'string') {\n    if (!currentVal || val.parentNode !== currentVal.parentNode || val.insertBeforeNode !== currentVal.insertBeforeNode) {\n      record.isDirty = true;\n      runDOMUpdates();\n    }\n  } else if (val !== currentVal) {\n    record.isDirty = true;\n    runDOMUpdates();\n  }\n}\n\nfunction htmlMutationRunner(record) {\n  var val = record.originalValue;\n  record.mutations.forEach(function (m) {\n    return val = m.mutate(val);\n  });\n  queueIfNeeded(getTransformedHTML(val), record);\n}\n\nfunction classMutationRunner(record) {\n  var val = new Set(record.originalValue.split(/\\s+/).filter(Boolean));\n  record.mutations.forEach(function (m) {\n    return m.mutate(val);\n  });\n  queueIfNeeded(Array.from(val).filter(Boolean).join(' '), record);\n}\n\nfunction attrMutationRunner(record) {\n  var val = record.originalValue;\n  record.mutations.forEach(function (m) {\n    return val = m.mutate(val);\n  });\n  queueIfNeeded(val, record);\n}\n\nfunction _loadDOMNodes(_ref) {\n  var parentSelector = _ref.parentSelector,\n      insertBeforeSelector = _ref.insertBeforeSelector;\n  var parentNode = document.querySelector(parentSelector);\n  if (!parentNode) return null;\n  var insertBeforeNode = insertBeforeSelector ? document.querySelector(insertBeforeSelector) : null;\n  if (insertBeforeSelector && !insertBeforeNode) return null;\n  return {\n    parentNode: parentNode,\n    insertBeforeNode: insertBeforeNode\n  };\n}\n\nfunction positionMutationRunner(record) {\n  var val = record.originalValue;\n  record.mutations.forEach(function (m) {\n    var selectors = m.mutate();\n\n    var newNodes = _loadDOMNodes(selectors);\n\n    val = newNodes || val;\n  });\n  queueIfNeeded(val, record);\n}\n\nvar getHTMLValue = function getHTMLValue(el) {\n  return el.innerHTML;\n};\n\nvar setHTMLValue = function setHTMLValue(el, value) {\n  return el.innerHTML = value;\n};\n\nfunction getElementHTMLRecord(element) {\n  var elementRecord = getElementRecord(element);\n\n  if (!elementRecord.html) {\n    elementRecord.html = createElementPropertyRecord(element, 'html', getHTMLValue, setHTMLValue, htmlMutationRunner);\n  }\n\n  return elementRecord.html;\n}\n\nvar getElementPosition = function getElementPosition(el) {\n  return {\n    parentNode: el.parentElement,\n    insertBeforeNode: el.nextElementSibling\n  };\n};\n\nvar setElementPosition = function setElementPosition(el, value) {\n  if (value.insertBeforeNode && !value.parentNode.contains(value.insertBeforeNode)) {\n    // skip position mutation - insertBeforeNode not a child of parent. happens\n    // when mutation observer for indvidual element fires out of order\n    return;\n  }\n\n  value.parentNode.insertBefore(el, value.insertBeforeNode);\n};\n\nfunction getElementPositionRecord(element) {\n  var elementRecord = getElementRecord(element);\n\n  if (!elementRecord.position) {\n    elementRecord.position = createElementPropertyRecord(element, 'position', getElementPosition, setElementPosition, positionMutationRunner);\n  }\n\n  return elementRecord.position;\n}\n\nvar setClassValue = function setClassValue(el, val) {\n  return val ? el.className = val : el.removeAttribute('class');\n};\n\nvar getClassValue = function getClassValue(el) {\n  return el.className;\n};\n\nfunction getElementClassRecord(el) {\n  var elementRecord = getElementRecord(el);\n\n  if (!elementRecord.classes) {\n    elementRecord.classes = createElementPropertyRecord(el, 'class', getClassValue, setClassValue, classMutationRunner);\n  }\n\n  return elementRecord.classes;\n}\n\nvar getAttrValue = function getAttrValue(attrName) {\n  return function (el) {\n    var _el$getAttribute;\n\n    return (_el$getAttribute = el.getAttribute(attrName)) != null ? _el$getAttribute : null;\n  };\n};\n\nvar setAttrValue = function setAttrValue(attrName) {\n  return function (el, val) {\n    return val !== null ? el.setAttribute(attrName, val) : el.removeAttribute(attrName);\n  };\n};\n\nfunction getElementAttributeRecord(el, attr) {\n  var elementRecord = getElementRecord(el);\n\n  if (!elementRecord.attributes[attr]) {\n    elementRecord.attributes[attr] = createElementPropertyRecord(el, attr, getAttrValue(attr), setAttrValue(attr), attrMutationRunner);\n  }\n\n  return elementRecord.attributes[attr];\n}\n\nfunction deleteElementPropertyRecord(el, attr) {\n  var element = elements.get(el);\n  if (!element) return;\n\n  if (attr === 'html') {\n    var _element$html, _element$html$observe;\n\n    (_element$html = element.html) == null ? void 0 : (_element$html$observe = _element$html.observer) == null ? void 0 : _element$html$observe.disconnect();\n    delete element.html;\n  } else if (attr === 'class') {\n    var _element$classes, _element$classes$obse;\n\n    (_element$classes = element.classes) == null ? void 0 : (_element$classes$obse = _element$classes.observer) == null ? void 0 : _element$classes$obse.disconnect();\n    delete element.classes;\n  } else if (attr === 'position') {\n    var _element$position, _element$position$obs;\n\n    (_element$position = element.position) == null ? void 0 : (_element$position$obs = _element$position.observer) == null ? void 0 : _element$position$obs.disconnect();\n    delete element.position;\n  } else {\n    var _element$attributes, _element$attributes$a, _element$attributes$a2;\n\n    (_element$attributes = element.attributes) == null ? void 0 : (_element$attributes$a = _element$attributes[attr]) == null ? void 0 : (_element$attributes$a2 = _element$attributes$a.observer) == null ? void 0 : _element$attributes$a2.disconnect();\n    delete element.attributes[attr];\n  }\n}\n\nvar transformContainer;\n\nfunction getTransformedHTML(html) {\n  if (!transformContainer) {\n    transformContainer = document.createElement('div');\n  }\n\n  transformContainer.innerHTML = html;\n  return transformContainer.innerHTML;\n}\n\nfunction setPropertyValue(el, attr, m) {\n  if (!m.isDirty) return;\n  m.isDirty = false;\n  var val = m.virtualValue;\n\n  if (!m.mutations.length) {\n    deleteElementPropertyRecord(el, attr);\n  }\n\n  m.setValue(el, val);\n}\n\nfunction setValue(m, el) {\n  m.html && setPropertyValue(el, 'html', m.html);\n  m.classes && setPropertyValue(el, 'class', m.classes);\n  m.position && setPropertyValue(el, 'position', m.position);\n  Object.keys(m.attributes).forEach(function (attr) {\n    setPropertyValue(el, attr, m.attributes[attr]);\n  });\n}\n\nfunction runDOMUpdates() {\n  elements.forEach(setValue);\n} // find or create ElementPropertyRecord, add mutation to it, then run\n\n\nfunction startMutating(mutation, element) {\n  var record = null;\n\n  if (mutation.kind === 'html') {\n    record = getElementHTMLRecord(element);\n  } else if (mutation.kind === 'class') {\n    record = getElementClassRecord(element);\n  } else if (mutation.kind === 'attribute') {\n    record = getElementAttributeRecord(element, mutation.attribute);\n  } else if (mutation.kind === 'position') {\n    record = getElementPositionRecord(element);\n  }\n\n  if (!record) return;\n  record.mutations.push(mutation);\n  record.mutationRunner(record);\n} // get (existing) ElementPropertyRecord, remove mutation from it, then run\n\n\nfunction stopMutating(mutation, el) {\n  var record = null;\n\n  if (mutation.kind === 'html') {\n    record = getElementHTMLRecord(el);\n  } else if (mutation.kind === 'class') {\n    record = getElementClassRecord(el);\n  } else if (mutation.kind === 'attribute') {\n    record = getElementAttributeRecord(el, mutation.attribute);\n  } else if (mutation.kind === 'position') {\n    record = getElementPositionRecord(el);\n  }\n\n  if (!record) return;\n  var index = record.mutations.indexOf(mutation);\n  if (index !== -1) record.mutations.splice(index, 1);\n  record.mutationRunner(record);\n} // maintain list of elements associated with mutation\n\n\nfunction refreshElementsSet(mutation) {\n  // if a position mutation has already found an element to move, don't move\n  // any more elements\n  if (mutation.kind === 'position' && mutation.elements.size === 1) return;\n  var existingElements = new Set(mutation.elements);\n  var matchingElements = document.querySelectorAll(mutation.selector);\n  matchingElements.forEach(function (el) {\n    if (!existingElements.has(el)) {\n      mutation.elements.add(el);\n      startMutating(mutation, el);\n    }\n  });\n}\n\nfunction revertMutation(mutation) {\n  mutation.elements.forEach(function (el) {\n    return stopMutating(mutation, el);\n  });\n  mutation.elements.clear();\n  mutations[\"delete\"](mutation);\n}\n\nfunction refreshAllElementSets() {\n  mutations.forEach(refreshElementsSet);\n} // Observer for elements that don't exist in the DOM yet\n\n\nvar observer;\nfunction disconnectGlobalObserver() {\n  observer && observer.disconnect();\n}\nfunction connectGlobalObserver() {\n  if (typeof document === 'undefined') return;\n\n  if (!observer) {\n    observer = new MutationObserver(function () {\n      refreshAllElementSets();\n    });\n  }\n\n  refreshAllElementSets();\n  observer.observe(document.documentElement, {\n    childList: true,\n    subtree: true,\n    attributes: false,\n    characterData: false\n  });\n} // run on init\n\nconnectGlobalObserver();\n\nfunction newMutation(m) {\n  // Not in a browser\n  if (typeof document === 'undefined') return nullController; // add to global index of mutations\n\n  mutations.add(m); // run refresh on init to establish list of elements associated w/ mutation\n\n  refreshElementsSet(m);\n  return {\n    revert: function revert() {\n      revertMutation(m);\n    }\n  };\n}\n\nfunction html(selector, mutate) {\n  return newMutation({\n    kind: 'html',\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction position(selector, mutate) {\n  return newMutation({\n    kind: 'position',\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction classes(selector, mutate) {\n  return newMutation({\n    kind: 'class',\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction attribute(selector, attribute, mutate) {\n  if (!validAttributeName.test(attribute)) return nullController;\n\n  if (attribute === 'class' || attribute === 'className') {\n    return classes(selector, function (classnames) {\n      var mutatedClassnames = mutate(Array.from(classnames).join(' '));\n      classnames.clear();\n      if (!mutatedClassnames) return;\n      mutatedClassnames.split(/\\s+/g).filter(Boolean).forEach(function (c) {\n        return classnames.add(c);\n      });\n    });\n  }\n\n  return newMutation({\n    kind: 'attribute',\n    attribute: attribute,\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction declarative(_ref2) {\n  var selector = _ref2.selector,\n      action = _ref2.action,\n      value = _ref2.value,\n      attr = _ref2.attribute,\n      parentSelector = _ref2.parentSelector,\n      insertBeforeSelector = _ref2.insertBeforeSelector;\n\n  if (attr === 'html') {\n    if (action === 'append') {\n      return html(selector, function (val) {\n        return val + (value != null ? value : '');\n      });\n    } else if (action === 'set') {\n      return html(selector, function () {\n        return value != null ? value : '';\n      });\n    }\n  } else if (attr === 'class') {\n    if (action === 'append') {\n      return classes(selector, function (val) {\n        if (value) val.add(value);\n      });\n    } else if (action === 'remove') {\n      return classes(selector, function (val) {\n        if (value) val[\"delete\"](value);\n      });\n    } else if (action === 'set') {\n      return classes(selector, function (val) {\n        val.clear();\n        if (value) val.add(value);\n      });\n    }\n  } else if (attr === 'position') {\n    if (action === 'set' && parentSelector) {\n      return position(selector, function () {\n        return {\n          insertBeforeSelector: insertBeforeSelector,\n          parentSelector: parentSelector\n        };\n      });\n    }\n  } else {\n    if (action === 'append') {\n      return attribute(selector, attr, function (val) {\n        return val !== null ? val + (value != null ? value : '') : value != null ? value : '';\n      });\n    } else if (action === 'set') {\n      return attribute(selector, attr, function () {\n        return value != null ? value : '';\n      });\n    } else if (action === 'remove') {\n      return attribute(selector, attr, function () {\n        return null;\n      });\n    }\n  }\n\n  return nullController;\n}\n\nvar index = {\n  html: html,\n  classes: classes,\n  attribute: attribute,\n  position: position,\n  declarative: declarative\n};\n\nexport default index;\nexport { connectGlobalObserver, disconnectGlobalObserver, validAttributeName };\n//# sourceMappingURL=dom-mutator.esm.js.map\n","import {\n  AutoExperiment,\n  AutoExperimentChangeType,\n  Polyfills,\n  UrlTarget,\n  UrlTargetType,\n  VariationRange,\n} from \"./types/growthbook\";\n\nconst polyfills: Polyfills = {\n  fetch: globalThis.fetch ? globalThis.fetch.bind(globalThis) : undefined,\n  SubtleCrypto: globalThis.crypto ? globalThis.crypto.subtle : undefined,\n  EventSource: globalThis.EventSource,\n};\nexport function getPolyfills(): Polyfills {\n  return polyfills;\n}\n\nfunction hashFnv32a(str: string): number {\n  let hval = 0x811c9dc5;\n  const l = str.length;\n\n  for (let i = 0; i < l; i++) {\n    hval ^= str.charCodeAt(i);\n    hval +=\n      (hval << 1) + (hval << 4) + (hval << 7) + (hval << 8) + (hval << 24);\n  }\n  return hval >>> 0;\n}\n\nexport function hash(\n  seed: string,\n  value: string,\n  version: number\n): number | null {\n  // New unbiased hashing algorithm\n  if (version === 2) {\n    return (hashFnv32a(hashFnv32a(seed + value) + \"\") % 10000) / 10000;\n  }\n  // Original biased hashing algorithm (keep for backwards compatibility)\n  if (version === 1) {\n    return (hashFnv32a(value + seed) % 1000) / 1000;\n  }\n\n  // Unknown hash version\n  return null;\n}\n\nexport function getEqualWeights(n: number): number[] {\n  if (n <= 0) return [];\n  return new Array(n).fill(1 / n);\n}\n\nexport function inRange(n: number, range: VariationRange): boolean {\n  return n >= range[0] && n < range[1];\n}\n\nexport function inNamespace(\n  hashValue: string,\n  namespace: [string, number, number]\n): boolean {\n  const n = hash(\"__\" + namespace[0], hashValue, 1);\n  if (n === null) return false;\n  return n >= namespace[1] && n < namespace[2];\n}\n\nexport function chooseVariation(n: number, ranges: VariationRange[]): number {\n  for (let i = 0; i < ranges.length; i++) {\n    if (inRange(n, ranges[i])) {\n      return i;\n    }\n  }\n  return -1;\n}\n\nexport function getUrlRegExp(regexString: string): RegExp | undefined {\n  try {\n    const escaped = regexString.replace(/([^\\\\])\\//g, \"$1\\\\/\");\n    return new RegExp(escaped);\n  } catch (e) {\n    console.error(e);\n    return undefined;\n  }\n}\n\nexport function isURLTargeted(url: string, targets: UrlTarget[]) {\n  if (!targets.length) return false;\n  let hasIncludeRules = false;\n  let isIncluded = false;\n\n  for (let i = 0; i < targets.length; i++) {\n    const match = _evalURLTarget(url, targets[i].type, targets[i].pattern);\n    if (targets[i].include === false) {\n      if (match) return false;\n    } else {\n      hasIncludeRules = true;\n      if (match) isIncluded = true;\n    }\n  }\n\n  return isIncluded || !hasIncludeRules;\n}\n\nfunction _evalSimpleUrlPart(\n  actual: string,\n  pattern: string,\n  isPath: boolean\n): boolean {\n  try {\n    // Escape special regex characters and change wildcard `_____` to `.*`\n    let escaped = pattern\n      .replace(/[*.+?^${}()|[\\]\\\\]/g, \"\\\\$&\")\n      .replace(/_____/g, \".*\");\n\n    if (isPath) {\n      // When matching pathname, make leading/trailing slashes optional\n      escaped = \"\\\\/?\" + escaped.replace(/(^\\/|\\/$)/g, \"\") + \"\\\\/?\";\n    }\n\n    const regex = new RegExp(\"^\" + escaped + \"$\", \"i\");\n    return regex.test(actual);\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _evalSimpleUrlTarget(actual: URL, pattern: string) {\n  try {\n    // If a protocol is missing, but a host is specified, add `https://` to the front\n    // Use \"_____\" as the wildcard since `*` is not a valid hostname in some browsers\n    const expected = new URL(\n      pattern.replace(/^([^:/?]*)\\./i, \"https://$1.\").replace(/\\*/g, \"_____\"),\n      \"https://_____\"\n    );\n\n    // Compare each part of the URL separately\n    const comps: Array<[string, string, boolean]> = [\n      [actual.host, expected.host, false],\n      [actual.pathname, expected.pathname, true],\n    ];\n    // We only want to compare hashes if it's explicitly being targeted\n    if (expected.hash) {\n      comps.push([actual.hash, expected.hash, false]);\n    }\n\n    expected.searchParams.forEach((v, k) => {\n      comps.push([actual.searchParams.get(k) || \"\", v, false]);\n    });\n\n    // If any comparisons fail, the whole thing fails\n    return !comps.some(\n      (data) => !_evalSimpleUrlPart(data[0], data[1], data[2])\n    );\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _evalURLTarget(\n  url: string,\n  type: UrlTargetType,\n  pattern: string\n): boolean {\n  try {\n    const parsed = new URL(url, \"https://_\");\n\n    if (type === \"regex\") {\n      const regex = getUrlRegExp(pattern);\n      if (!regex) return false;\n      return (\n        regex.test(parsed.href) ||\n        regex.test(parsed.href.substring(parsed.origin.length))\n      );\n    } else if (type === \"simple\") {\n      return _evalSimpleUrlTarget(parsed, pattern);\n    }\n\n    return false;\n  } catch (e) {\n    return false;\n  }\n}\n\nexport function getBucketRanges(\n  numVariations: number,\n  coverage: number | undefined,\n  weights?: number[]\n): VariationRange[] {\n  coverage = coverage === undefined ? 1 : coverage;\n\n  // Make sure coverage is within bounds\n  if (coverage < 0) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.coverage must be greater than or equal to 0\");\n    }\n    coverage = 0;\n  } else if (coverage > 1) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.coverage must be less than or equal to 1\");\n    }\n    coverage = 1;\n  }\n\n  // Default to equal weights if missing or invalid\n  const equal = getEqualWeights(numVariations);\n  weights = weights || equal;\n  if (weights.length !== numVariations) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\n        \"Experiment.weights array must be the same length as Experiment.variations\"\n      );\n    }\n    weights = equal;\n  }\n\n  // If weights don't add up to 1 (or close to it), default to equal weights\n  const totalWeight = weights.reduce((w, sum) => sum + w, 0);\n  if (totalWeight < 0.99 || totalWeight > 1.01) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.weights must add up to 1\");\n    }\n    weights = equal;\n  }\n\n  // Covert weights to ranges\n  let cumulative = 0;\n  return weights.map((w) => {\n    const start = cumulative;\n    cumulative += w;\n    return [start, start + (coverage as number) * w];\n  }) as VariationRange[];\n}\n\nexport function getQueryStringOverride(\n  id: string,\n  url: string,\n  numVariations: number\n) {\n  if (!url) {\n    return null;\n  }\n\n  const search = url.split(\"?\")[1];\n  if (!search) {\n    return null;\n  }\n\n  const match = search\n    .replace(/#.*/, \"\") // Get rid of anchor\n    .split(\"&\") // Split into key/value pairs\n    .map((kv) => kv.split(\"=\", 2))\n    .filter(([k]) => k === id) // Look for key that matches the experiment id\n    .map(([, v]) => parseInt(v)); // Parse the value into an integer\n\n  if (match.length > 0 && match[0] >= 0 && match[0] < numVariations)\n    return match[0];\n\n  return null;\n}\n\nexport function isIncluded(include: () => boolean) {\n  try {\n    return include();\n  } catch (e) {\n    console.error(e);\n    return false;\n  }\n}\n\nconst base64ToBuf = (b: string) =>\n  Uint8Array.from(atob(b), (c) => c.charCodeAt(0));\n\nexport async function decrypt(\n  encryptedString: string,\n  decryptionKey?: string,\n  subtle?: SubtleCrypto\n): Promise<string> {\n  decryptionKey = decryptionKey || \"\";\n  subtle =\n    subtle ||\n    (globalThis.crypto && globalThis.crypto.subtle) ||\n    polyfills.SubtleCrypto;\n  if (!subtle) {\n    throw new Error(\"No SubtleCrypto implementation found\");\n  }\n  try {\n    const key = await subtle.importKey(\n      \"raw\",\n      base64ToBuf(decryptionKey),\n      { name: \"AES-CBC\", length: 128 },\n      true,\n      [\"encrypt\", \"decrypt\"]\n    );\n    const [iv, cipherText] = encryptedString.split(\".\");\n    const plainTextBuffer = await subtle.decrypt(\n      { name: \"AES-CBC\", iv: base64ToBuf(iv) },\n      key,\n      base64ToBuf(cipherText)\n    );\n\n    return new TextDecoder().decode(plainTextBuffer);\n  } catch (e) {\n    throw new Error(\"Failed to decrypt\");\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function toString(input: any): string {\n  if (typeof input === \"string\") return input;\n  return JSON.stringify(input);\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function paddedVersionString(input: any): string {\n  if (typeof input === \"number\") {\n    input = input + \"\";\n  }\n  if (!input || typeof input !== \"string\") {\n    input = \"0\";\n  }\n  // Remove build info and leading `v` if any\n  // Split version into parts (both core version numbers and pre-release tags)\n  // \"v1.2.3-rc.1+build123\" -> [\"1\",\"2\",\"3\",\"rc\",\"1\"]\n  const parts = (input as string).replace(/(^v|\\+.*$)/g, \"\").split(/[-.]/);\n\n  // If it's SemVer without a pre-release, add `~` to the end\n  // [\"1\",\"0\",\"0\"] -> [\"1\",\"0\",\"0\",\"~\"]\n  // \"~\" is the largest ASCII character, so this will make \"1.0.0\" greater than \"1.0.0-beta\" for example\n  if (parts.length === 3) {\n    parts.push(\"~\");\n  }\n\n  // Left pad each numeric part with spaces so string comparisons will work (\"9\">\"10\", but \" 9\"<\"10\")\n  // Then, join back together into a single string\n  return parts\n    .map((v) => (v.match(/^[0-9]+$/) ? v.padStart(5, \" \") : v))\n    .join(\"-\");\n}\n\nexport function loadSDKVersion(): string {\n  let version: string;\n  try {\n    // @ts-expect-error right-hand value to be replaced by build with string literal\n    version = __SDK_VERSION__;\n  } catch (e) {\n    version = \"\";\n  }\n  return version;\n}\n\nexport function mergeQueryStrings(oldUrl: string, newUrl: string): string {\n  let currUrl: URL;\n  let redirectUrl: URL;\n  try {\n    currUrl = new URL(oldUrl);\n    redirectUrl = new URL(newUrl);\n  } catch (e) {\n    console.error(`Unable to merge query strings: ${e}`);\n    return newUrl;\n  }\n\n  currUrl.searchParams.forEach((value, key) => {\n    // skip  if search param already exists in redirectUrl\n    if (redirectUrl.searchParams.has(key)) {\n      return;\n    }\n    redirectUrl.searchParams.set(key, value);\n  });\n\n  return redirectUrl.toString();\n}\n\nfunction isObj(x: unknown): x is Record<string, unknown> {\n  return typeof x === \"object\" && x !== null;\n}\n\nexport function getAutoExperimentChangeType(\n  exp: AutoExperiment\n): AutoExperimentChangeType {\n  if (\n    exp.urlPatterns &&\n    exp.variations.some(\n      (variation) => isObj(variation) && \"urlRedirect\" in variation\n    )\n  ) {\n    return \"redirect\";\n  } else if (\n    exp.variations.some(\n      (variation) =>\n        isObj(variation) &&\n        (variation.domMutations || \"js\" in variation || \"css\" in variation)\n    )\n  ) {\n    return \"visual\";\n  }\n\n  return \"unknown\";\n}\n\n// Guarantee the promise always resolves within {timeout} ms\n// Resolved value will be `null` when there's an error or it takes too long\n// Note: The promise will continue running in the background, even if the timeout is hit\nexport async function promiseTimeout<T>(\n  promise: Promise<T>,\n  timeout?: number\n): Promise<T | null> {\n  return new Promise((resolve) => {\n    let resolved = false;\n    let timer: NodeJS.Timeout | undefined;\n    const finish = (data?: T) => {\n      if (resolved) return;\n      resolved = true;\n      timer && clearTimeout(timer);\n      resolve(data || null);\n    };\n\n    if (timeout) {\n      timer = setTimeout(() => finish(), timeout);\n    }\n\n    promise.then((data) => finish(data)).catch(() => finish());\n  });\n}\n","import {\n  Attributes,\n  CacheSettings,\n  FeatureApiResponse,\n  FetchResponse,\n  Helpers,\n  Polyfills,\n} from \"./types/growthbook\";\nimport { getPolyfills, promiseTimeout } from \"./util\";\nimport type {\n  GrowthBook,\n  InitOptions,\n  InitSyncOptions,\n  GrowthBookClient,\n} from \".\";\n\ntype CacheEntry = {\n  data: FeatureApiResponse;\n  sse?: boolean;\n  version: string;\n  staleAt: Date;\n};\ntype ScopedChannel = {\n  src: EventSource | null;\n  cb: (event: MessageEvent<string>) => void;\n  host: string;\n  clientKey: string;\n  headers?: Record<string, string>;\n  errors: number;\n  state: \"active\" | \"idle\" | \"disabled\";\n};\n\n// Config settings\nconst cacheSettings: CacheSettings = {\n  // Consider a fetch stale after 1 minute\n  staleTTL: 1000 * 60,\n  // Max time to keep a fetch in cache (4 hours default)\n  maxAge: 1000 * 60 * 60 * 4,\n  cacheKey: \"gbFeaturesCache\",\n  backgroundSync: true,\n  maxEntries: 10,\n  disableIdleStreams: false,\n  idleStreamInterval: 20000,\n  disableCache: false,\n};\n\nconst polyfills = getPolyfills();\n\nexport const helpers: Helpers = {\n  fetchFeaturesCall: ({ host, clientKey, headers }) => {\n    return (polyfills.fetch as typeof globalThis.fetch)(\n      `${host}/api/features/${clientKey}`,\n      { headers }\n    );\n  },\n  fetchRemoteEvalCall: ({ host, clientKey, payload, headers }) => {\n    const options = {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\", ...headers },\n      body: JSON.stringify(payload),\n    };\n    return (polyfills.fetch as typeof globalThis.fetch)(\n      `${host}/api/eval/${clientKey}`,\n      options\n    );\n  },\n  eventSourceCall: ({ host, clientKey, headers }) => {\n    if (headers) {\n      return new polyfills.EventSource(`${host}/sub/${clientKey}`, {\n        headers,\n      });\n    }\n    return new polyfills.EventSource(`${host}/sub/${clientKey}`);\n  },\n  startIdleListener: () => {\n    let idleTimeout: number | undefined;\n    const isBrowser =\n      typeof window !== \"undefined\" && typeof document !== \"undefined\";\n    if (!isBrowser) return;\n    const onVisibilityChange = () => {\n      if (document.visibilityState === \"visible\") {\n        window.clearTimeout(idleTimeout);\n        onVisible();\n      } else if (document.visibilityState === \"hidden\") {\n        idleTimeout = window.setTimeout(\n          onHidden,\n          cacheSettings.idleStreamInterval\n        );\n      }\n    };\n    document.addEventListener(\"visibilitychange\", onVisibilityChange);\n    return () =>\n      document.removeEventListener(\"visibilitychange\", onVisibilityChange);\n  },\n  stopIdleListener: () => {\n    // No-op, replaced by startIdleListener\n  },\n};\n\ntry {\n  if (globalThis.localStorage) {\n    polyfills.localStorage = globalThis.localStorage;\n  }\n} catch (e) {\n  // Ignore localStorage errors\n}\n\n// Global state\nconst subscribedInstances: Map<\n  string,\n  Set<GrowthBook | GrowthBookClient>\n> = new Map();\nlet cacheInitialized = false;\nconst cache: Map<string, CacheEntry> = new Map();\nconst activeFetches: Map<string, Promise<FetchResponse>> = new Map();\nconst streams: Map<string, ScopedChannel> = new Map();\nconst supportsSSE: Set<string> = new Set();\n\n// Public functions\nexport function setPolyfills(overrides: Partial<Polyfills>): void {\n  Object.assign(polyfills, overrides);\n}\nexport function configureCache(overrides: Partial<CacheSettings>): void {\n  Object.assign(cacheSettings, overrides);\n  if (!cacheSettings.backgroundSync) {\n    clearAutoRefresh();\n  }\n}\n\nexport async function clearCache(): Promise<void> {\n  cache.clear();\n  activeFetches.clear();\n  clearAutoRefresh();\n  cacheInitialized = false;\n  await updatePersistentCache();\n}\n\n// Get or fetch features and refresh the SDK instance\nexport async function refreshFeatures({\n  instance,\n  timeout,\n  skipCache,\n  allowStale,\n  backgroundSync,\n}: {\n  instance: GrowthBook | GrowthBookClient;\n  timeout?: number;\n  skipCache?: boolean;\n  allowStale?: boolean;\n  backgroundSync?: boolean;\n}): Promise<FetchResponse> {\n  if (!backgroundSync) {\n    cacheSettings.backgroundSync = false;\n  }\n\n  return fetchFeaturesWithCache({\n    instance,\n    allowStale,\n    timeout,\n    skipCache,\n  });\n}\n\n// Subscribe a GrowthBook instance to feature changes\nfunction subscribe(instance: GrowthBook | GrowthBookClient): void {\n  const key = getKey(instance);\n  const subs = subscribedInstances.get(key) || new Set();\n  subs.add(instance);\n  subscribedInstances.set(key, subs);\n}\nexport function unsubscribe(instance: GrowthBook | GrowthBookClient): void {\n  subscribedInstances.forEach((s) => s.delete(instance));\n}\n\nexport function onHidden() {\n  streams.forEach((channel) => {\n    if (!channel) return;\n    channel.state = \"idle\";\n    disableChannel(channel);\n  });\n}\n\nexport function onVisible() {\n  streams.forEach((channel) => {\n    if (!channel) return;\n    if (channel.state !== \"idle\") return;\n    enableChannel(channel);\n  });\n}\n\n// Private functions\n\nasync function updatePersistentCache() {\n  try {\n    if (!polyfills.localStorage) return;\n    await polyfills.localStorage.setItem(\n      cacheSettings.cacheKey,\n      JSON.stringify(Array.from(cache.entries()))\n    );\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n}\n\n// SWR wrapper for fetching features. May indirectly or directly start SSE streaming.\nasync function fetchFeaturesWithCache({\n  instance,\n  allowStale,\n  timeout,\n  skipCache,\n}: {\n  instance: GrowthBook | GrowthBookClient;\n  allowStale?: boolean;\n  timeout?: number;\n  skipCache?: boolean;\n}): Promise<FetchResponse> {\n  const key = getKey(instance);\n  const cacheKey = getCacheKey(instance);\n  const now = new Date();\n\n  const minStaleAt = new Date(\n    now.getTime() - cacheSettings.maxAge + cacheSettings.staleTTL\n  );\n\n  await initializeCache();\n  const existing =\n    !cacheSettings.disableCache && !skipCache ? cache.get(cacheKey) : undefined;\n  if (\n    existing &&\n    (allowStale || existing.staleAt > now) &&\n    existing.staleAt > minStaleAt\n  ) {\n    // Restore from cache whether SSE is supported\n    if (existing.sse) supportsSSE.add(key);\n\n    // Reload features in the background if stale\n    if (existing.staleAt < now) {\n      fetchFeatures(instance);\n    }\n    // Otherwise, if we don't need to refresh now, start a background sync\n    else {\n      startAutoRefresh(instance);\n    }\n    return { data: existing.data, success: true, source: \"cache\" };\n  } else {\n    const res = await promiseTimeout(fetchFeatures(instance), timeout);\n    return (\n      res || {\n        data: null,\n        success: false,\n        source: \"timeout\",\n        error: new Error(\"Timeout\"),\n      }\n    );\n  }\n}\n\nfunction getKey(instance: GrowthBook | GrowthBookClient): string {\n  const [apiHost, clientKey] = instance.getApiInfo();\n  return `${apiHost}||${clientKey}`;\n}\n\nfunction getCacheKey(instance: GrowthBook | GrowthBookClient): string {\n  const baseKey = getKey(instance);\n  if (!(\"isRemoteEval\" in instance) || !instance.isRemoteEval()) return baseKey;\n\n  const attributes = instance.getAttributes();\n  const cacheKeyAttributes =\n    instance.getCacheKeyAttributes() || Object.keys(instance.getAttributes());\n  const ca: Attributes = {};\n  cacheKeyAttributes.forEach((key) => {\n    ca[key] = attributes[key];\n  });\n\n  const fv = instance.getForcedVariations();\n  const url = instance.getUrl();\n\n  return `${baseKey}||${JSON.stringify({\n    ca,\n    fv,\n    url,\n  })}`;\n}\n\n// Populate cache from localStorage (if available)\nasync function initializeCache(): Promise<void> {\n  if (cacheInitialized) return;\n  cacheInitialized = true;\n  try {\n    if (polyfills.localStorage) {\n      const value = await polyfills.localStorage.getItem(\n        cacheSettings.cacheKey\n      );\n      if (!cacheSettings.disableCache && value) {\n        const parsed: [string, CacheEntry][] = JSON.parse(value);\n        if (parsed && Array.isArray(parsed)) {\n          parsed.forEach(([key, data]) => {\n            cache.set(key, {\n              ...data,\n              staleAt: new Date(data.staleAt),\n            });\n          });\n        }\n        cleanupCache();\n      }\n    }\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n  if (!cacheSettings.disableIdleStreams) {\n    const cleanupFn = helpers.startIdleListener();\n    if (cleanupFn) {\n      helpers.stopIdleListener = cleanupFn;\n    }\n  }\n}\n\n// Enforce the maxEntries limit\nfunction cleanupCache() {\n  const entriesWithTimestamps = Array.from(cache.entries())\n    .map(([key, value]) => ({\n      key,\n      staleAt: value.staleAt.getTime(),\n    }))\n    .sort((a, b) => a.staleAt - b.staleAt);\n\n  const entriesToRemoveCount = Math.min(\n    Math.max(0, cache.size - cacheSettings.maxEntries),\n    cache.size\n  );\n\n  for (let i = 0; i < entriesToRemoveCount; i++) {\n    cache.delete(entriesWithTimestamps[i].key);\n  }\n}\n\n// Called whenever new features are fetched from the API\nfunction onNewFeatureData(\n  key: string,\n  cacheKey: string,\n  data: FeatureApiResponse\n): void {\n  // If contents haven't changed, ignore the update, extend the stale TTL\n  const version = data.dateUpdated || \"\";\n  const staleAt = new Date(Date.now() + cacheSettings.staleTTL);\n  const existing = !cacheSettings.disableCache\n    ? cache.get(cacheKey)\n    : undefined;\n  if (existing && version && existing.version === version) {\n    existing.staleAt = staleAt;\n    updatePersistentCache();\n    return;\n  }\n\n  if (!cacheSettings.disableCache) {\n    // Update in-memory cache\n    cache.set(cacheKey, {\n      data,\n      version,\n      staleAt,\n      sse: supportsSSE.has(key),\n    });\n    cleanupCache();\n  }\n  // Update local storage (don't await this, just update asynchronously)\n  updatePersistentCache();\n\n  // Update features for all subscribed GrowthBook instances\n  const instances = subscribedInstances.get(key);\n  instances && instances.forEach((instance) => refreshInstance(instance, data));\n}\n\nasync function refreshInstance(\n  instance: GrowthBook | GrowthBookClient,\n  data: FeatureApiResponse | null\n): Promise<void> {\n  await instance.setPayload(data || instance.getPayload());\n}\n\n// Fetch the features payload from helper function or from in-mem injected payload\nasync function fetchFeatures(\n  instance: GrowthBook | GrowthBookClient\n): Promise<FetchResponse> {\n  const { apiHost, apiRequestHeaders } = instance.getApiHosts();\n  const clientKey = instance.getClientKey();\n  const remoteEval = \"isRemoteEval\" in instance && instance.isRemoteEval();\n  const key = getKey(instance);\n  const cacheKey = getCacheKey(instance);\n\n  let promise = activeFetches.get(cacheKey);\n  if (!promise) {\n    const fetcher: Promise<Response> = remoteEval\n      ? helpers.fetchRemoteEvalCall({\n          host: apiHost,\n          clientKey,\n          payload: {\n            attributes: instance.getAttributes(),\n            forcedVariations: instance.getForcedVariations(),\n            forcedFeatures: Array.from(instance.getForcedFeatures().entries()),\n            url: instance.getUrl(),\n          },\n          headers: apiRequestHeaders,\n        })\n      : helpers.fetchFeaturesCall({\n          host: apiHost,\n          clientKey,\n          headers: apiRequestHeaders,\n        });\n\n    // TODO: auto-retry if status code indicates a temporary error\n    promise = fetcher\n      .then((res) => {\n        if (!res.ok) {\n          throw new Error(`HTTP error: ${res.status}`);\n        }\n        if (res.headers.get(\"x-sse-support\") === \"enabled\") {\n          supportsSSE.add(key);\n        }\n        return res.json();\n      })\n      .then((data: FeatureApiResponse) => {\n        onNewFeatureData(key, cacheKey, data);\n        startAutoRefresh(instance);\n        activeFetches.delete(cacheKey);\n        return { data, success: true, source: \"network\" as const };\n      })\n      .catch((e) => {\n        process.env.NODE_ENV !== \"production\" &&\n          instance.log(\"Error fetching features\", {\n            apiHost,\n            clientKey,\n            error: e ? e.message : null,\n          });\n        activeFetches.delete(cacheKey);\n\n        return {\n          data: null,\n          source: \"error\" as const,\n          success: false,\n          error: e,\n        };\n      });\n    activeFetches.set(cacheKey, promise);\n  }\n  return promise;\n}\n\n// Start SSE streaming, listens to feature payload changes and triggers a refresh or re-fetch\nfunction startAutoRefresh(\n  instance: GrowthBook | GrowthBookClient,\n  forceSSE: boolean = false\n): void {\n  const key = getKey(instance);\n  const cacheKey = getCacheKey(instance);\n  const { streamingHost, streamingHostRequestHeaders } = instance.getApiHosts();\n  const clientKey = instance.getClientKey();\n\n  if (forceSSE) {\n    supportsSSE.add(key);\n  }\n\n  if (\n    cacheSettings.backgroundSync &&\n    supportsSSE.has(key) &&\n    polyfills.EventSource\n  ) {\n    if (streams.has(key)) return;\n    const channel: ScopedChannel = {\n      src: null,\n      host: streamingHost,\n      clientKey,\n      headers: streamingHostRequestHeaders,\n      cb: (event: MessageEvent<string>) => {\n        try {\n          if (event.type === \"features-updated\") {\n            const instances = subscribedInstances.get(key);\n            instances &&\n              instances.forEach((instance) => {\n                fetchFeatures(instance);\n              });\n          } else if (event.type === \"features\") {\n            const json: FeatureApiResponse = JSON.parse(event.data);\n            onNewFeatureData(key, cacheKey, json);\n          }\n          // Reset error count on success\n          channel.errors = 0;\n        } catch (e) {\n          process.env.NODE_ENV !== \"production\" &&\n            instance.log(\"SSE Error\", {\n              streamingHost,\n              clientKey,\n              error: e ? (e as Error).message : null,\n            });\n          onSSEError(channel);\n        }\n      },\n      errors: 0,\n      state: \"active\",\n    };\n    streams.set(key, channel);\n    enableChannel(channel);\n  }\n}\n\nfunction onSSEError(channel: ScopedChannel) {\n  if (channel.state === \"idle\") return;\n  channel.errors++;\n  if (channel.errors > 3 || (channel.src && channel.src.readyState === 2)) {\n    // exponential backoff after 4 errors, with jitter\n    const delay =\n      Math.pow(3, channel.errors - 3) * (1000 + Math.random() * 1000);\n    disableChannel(channel);\n    setTimeout(() => {\n      if ([\"idle\", \"active\"].includes(channel.state)) return;\n      enableChannel(channel);\n    }, Math.min(delay, 300000)); // 5 minutes max\n  }\n}\n\nfunction disableChannel(channel: ScopedChannel) {\n  if (!channel.src) return;\n  channel.src.onopen = null;\n  channel.src.onerror = null;\n  channel.src.close();\n  channel.src = null;\n  if (channel.state === \"active\") {\n    channel.state = \"disabled\";\n  }\n}\n\nfunction enableChannel(channel: ScopedChannel) {\n  channel.src = helpers.eventSourceCall({\n    host: channel.host,\n    clientKey: channel.clientKey,\n    headers: channel.headers,\n  }) as EventSource;\n  channel.state = \"active\";\n  channel.src.addEventListener(\"features\", channel.cb);\n  channel.src.addEventListener(\"features-updated\", channel.cb);\n  channel.src.onerror = () => onSSEError(channel);\n  channel.src.onopen = () => {\n    channel.errors = 0;\n  };\n}\n\nfunction destroyChannel(channel: ScopedChannel, key: string) {\n  disableChannel(channel);\n  streams.delete(key);\n}\n\nfunction clearAutoRefresh() {\n  // Clear list of which keys are auto-updated\n  supportsSSE.clear();\n\n  // Stop listening for any SSE events\n  streams.forEach(destroyChannel);\n\n  // Remove all references to GrowthBook instances\n  subscribedInstances.clear();\n\n  // Run the idle stream cleanup function\n  helpers.stopIdleListener();\n}\n\nexport function startStreaming(\n  instance: GrowthBook | GrowthBookClient,\n  options: InitOptions | InitSyncOptions\n) {\n  if (options.streaming) {\n    if (!instance.getClientKey()) {\n      throw new Error(\"Must specify clientKey to enable streaming\");\n    }\n    if (options.payload) {\n      startAutoRefresh(instance, true);\n    }\n    subscribe(instance);\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport { SavedGroupsValues } from \"./types/growthbook\";\nimport {\n  ConditionInterface,\n  TestedObj,\n  ConditionValue,\n  Operator,\n  OperatorConditionValue,\n  VarType,\n} from \"./types/mongrule\";\nimport { paddedVersionString } from \"./util\";\n\nconst _regexCache: { [key: string]: RegExp } = {};\n\n// The top-level condition evaluation function\nexport function evalCondition(\n  obj: TestedObj,\n  condition: ConditionInterface,\n  // Must be included for `condition` to correctly evaluate group Operators\n  savedGroups?: SavedGroupsValues\n): boolean {\n  savedGroups = savedGroups || {};\n  // Condition is an object, keys are either specific operators or object paths\n  // values are either arguments for operators or conditions for paths\n  for (const [k, v] of Object.entries(condition)) {\n    switch (k) {\n      case \"$or\":\n        if (!evalOr(obj, v as ConditionInterface[], savedGroups)) return false;\n        break;\n      case \"$nor\":\n        if (evalOr(obj, v as ConditionInterface[], savedGroups)) return false;\n        break;\n      case \"$and\":\n        if (!evalAnd(obj, v as ConditionInterface[], savedGroups)) return false;\n        break;\n      case \"$not\":\n        if (evalCondition(obj, v as ConditionInterface, savedGroups))\n          return false;\n        break;\n      default:\n        if (!evalConditionValue(v, getPath(obj, k), savedGroups)) return false;\n    }\n  }\n  return true;\n}\n\n// Return value at dot-separated path of an object\nfunction getPath(obj: TestedObj, path: string) {\n  const parts = path.split(\".\");\n  let current: any = obj;\n  for (let i = 0; i < parts.length; i++) {\n    if (current && typeof current === \"object\" && parts[i] in current) {\n      current = current[parts[i]];\n    } else {\n      return null;\n    }\n  }\n  return current;\n}\n\n// Transform a regex string into a real RegExp object\nfunction getRegex(regex: string): RegExp {\n  if (!_regexCache[regex]) {\n    _regexCache[regex] = new RegExp(regex.replace(/([^\\\\])\\//g, \"$1\\\\/\"));\n  }\n  return _regexCache[regex];\n}\n\n// Evaluate a single value against a condition\nfunction evalConditionValue(\n  condition: ConditionValue,\n  value: any,\n  savedGroups: SavedGroupsValues\n) {\n  // Simple equality comparisons\n  if (typeof condition === \"string\") {\n    return value + \"\" === condition;\n  }\n  if (typeof condition === \"number\") {\n    return value * 1 === condition;\n  }\n  if (typeof condition === \"boolean\") {\n    return value !== null && !!value === condition;\n  }\n\n  if (condition === null) {\n    return value === null;\n  }\n\n  if (Array.isArray(condition) || !isOperatorObject(condition)) {\n    return JSON.stringify(value) === JSON.stringify(condition);\n  }\n\n  // This is a special operator condition and we should evaluate each one separately\n  for (const op in condition) {\n    if (\n      !evalOperatorCondition(\n        op as Operator,\n        value,\n        condition[op as keyof OperatorConditionValue],\n        savedGroups\n      )\n    ) {\n      return false;\n    }\n  }\n  return true;\n}\n\n// If the object has only keys that start with '$'\nfunction isOperatorObject(obj: any): boolean {\n  const keys = Object.keys(obj);\n  return (\n    keys.length > 0 && keys.filter((k) => k[0] === \"$\").length === keys.length\n  );\n}\n\n// Return the data type of a value\nfunction getType(v: any): VarType | \"unknown\" {\n  if (v === null) return \"null\";\n  if (Array.isArray(v)) return \"array\";\n  const t = typeof v;\n  if ([\"string\", \"number\", \"boolean\", \"object\", \"undefined\"].includes(t)) {\n    return t as VarType;\n  }\n  return \"unknown\";\n}\n\n// At least one element of actual must match the expected condition/value\nfunction elemMatch(actual: any, expected: any, savedGroups: SavedGroupsValues) {\n  if (!Array.isArray(actual)) return false;\n  const check = isOperatorObject(expected)\n    ? (v: any) => evalConditionValue(expected, v, savedGroups)\n    : (v: any) => evalCondition(v, expected, savedGroups);\n  for (let i = 0; i < actual.length; i++) {\n    if (actual[i] && check(actual[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction isIn(actual: any, expected: Array<any>): boolean {\n  // Do an intersection if attribute is an array\n  if (Array.isArray(actual)) {\n    return actual.some((el) => expected.includes(el));\n  }\n  return expected.includes(actual);\n}\n\n// Evaluate a single operator condition\nfunction evalOperatorCondition(\n  operator: Operator,\n  actual: any,\n  expected: any,\n  savedGroups: SavedGroupsValues\n): boolean {\n  switch (operator) {\n    case \"$veq\":\n      return paddedVersionString(actual) === paddedVersionString(expected);\n    case \"$vne\":\n      return paddedVersionString(actual) !== paddedVersionString(expected);\n    case \"$vgt\":\n      return paddedVersionString(actual) > paddedVersionString(expected);\n    case \"$vgte\":\n      return paddedVersionString(actual) >= paddedVersionString(expected);\n    case \"$vlt\":\n      return paddedVersionString(actual) < paddedVersionString(expected);\n    case \"$vlte\":\n      return paddedVersionString(actual) <= paddedVersionString(expected);\n    case \"$eq\":\n      return actual === expected;\n    case \"$ne\":\n      return actual !== expected;\n    case \"$lt\":\n      return actual < expected;\n    case \"$lte\":\n      return actual <= expected;\n    case \"$gt\":\n      return actual > expected;\n    case \"$gte\":\n      return actual >= expected;\n    case \"$exists\":\n      // Using `!=` and `==` instead of strict checks so it also matches for undefined\n      return expected ? actual != null : actual == null;\n    case \"$in\":\n      if (!Array.isArray(expected)) return false;\n      return isIn(actual, expected);\n    case \"$inGroup\":\n      return isIn(actual, savedGroups[expected] || []);\n    case \"$notInGroup\":\n      return !isIn(actual, savedGroups[expected] || []);\n    case \"$nin\":\n      if (!Array.isArray(expected)) return false;\n      return !isIn(actual, expected);\n    case \"$not\":\n      return !evalConditionValue(expected, actual, savedGroups);\n    case \"$size\":\n      if (!Array.isArray(actual)) return false;\n      return evalConditionValue(expected, actual.length, savedGroups);\n    case \"$elemMatch\":\n      return elemMatch(actual, expected, savedGroups);\n    case \"$all\":\n      if (!Array.isArray(actual)) return false;\n      for (let i = 0; i < expected.length; i++) {\n        let passed = false;\n        for (let j = 0; j < actual.length; j++) {\n          if (evalConditionValue(expected[i], actual[j], savedGroups)) {\n            passed = true;\n            break;\n          }\n        }\n        if (!passed) return false;\n      }\n      return true;\n    case \"$regex\":\n      try {\n        return getRegex(expected).test(actual);\n      } catch (e) {\n        return false;\n      }\n    case \"$type\":\n      return getType(actual) === expected;\n    default:\n      console.error(\"Unknown operator: \" + operator);\n      return false;\n  }\n}\n\n// Recursive $or rule\nfunction evalOr(\n  obj: TestedObj,\n  conditions: ConditionInterface[],\n  savedGroups: SavedGroupsValues\n): boolean {\n  if (!conditions.length) return true;\n  for (let i = 0; i < conditions.length; i++) {\n    if (evalCondition(obj, conditions[i], savedGroups)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// Recursive $and rule\nfunction evalAnd(\n  obj: TestedObj,\n  conditions: ConditionInterface[],\n  savedGroups: SavedGroupsValues\n): boolean {\n  for (let i = 0; i < conditions.length; i++) {\n    if (!evalCondition(obj, conditions[i], savedGroups)) {\n      return false;\n    }\n  }\n  return true;\n}\n","import {\n  EvalContext,\n  FeatureDefinition,\n  FeatureResult,\n  Experiment,\n  FeatureResultSource,\n  Result,\n  Filter,\n  VariationRange,\n  VariationMeta,\n  StickyExperimentKey,\n  StickyAssignments,\n  StickyAttributeKey,\n  StickyAssignmentsDocument,\n  FeatureApiResponse,\n  Options,\n  ClientOptions,\n} from \"./types/growthbook\";\nimport { evalCondition } from \"./mongrule\";\nimport { ConditionInterface } from \"./types/mongrule\";\nimport {\n  chooseVariation,\n  decrypt,\n  getBucketRanges,\n  getQueryStringOverride,\n  getUrlRegExp,\n  hash,\n  inNamespace,\n  inRange,\n  isIncluded,\n  isURLTargeted,\n  toString,\n} from \"./util\";\nimport { StickyBucketService } from \"./sticky-bucket-service\";\n\nexport const EVENT_FEATURE_EVALUATED = \"Feature Evaluated\";\nexport const EVENT_EXPERIMENT_VIEWED = \"Experiment Viewed\";\n\nfunction getForcedFeatureValues(ctx: EvalContext) {\n  // Merge user and global values\n  const ret: typeof ctx.global.forcedFeatureValues = new Map();\n  if (ctx.global.forcedFeatureValues) {\n    ctx.global.forcedFeatureValues.forEach((v, k) => ret.set(k, v));\n  }\n  if (ctx.user.forcedFeatureValues) {\n    ctx.user.forcedFeatureValues.forEach((v, k) => ret.set(k, v));\n  }\n  return ret;\n}\n\nfunction getForcedVariations(ctx: EvalContext) {\n  // Merge user and global values\n  if (ctx.global.forcedVariations && ctx.user.forcedVariations) {\n    return { ...ctx.global.forcedVariations, ...ctx.user.forcedVariations };\n  } else if (ctx.global.forcedVariations) {\n    return ctx.global.forcedVariations;\n  } else if (ctx.user.forcedVariations) {\n    return ctx.user.forcedVariations;\n  } else {\n    return {};\n  }\n}\n\nasync function safeCall(fn: () => void | Promise<void>) {\n  try {\n    await fn();\n  } catch (e) {\n    // Do nothing\n  }\n}\n\nfunction onExperimentViewed(\n  ctx: EvalContext,\n  experiment: Experiment<unknown>,\n  result: Result<unknown>\n): Promise<void>[] {\n  // Make sure a tracking callback is only fired once per unique experiment\n  if (ctx.user.trackedExperiments) {\n    const k = getExperimentDedupeKey(experiment, result);\n    if (ctx.user.trackedExperiments.has(k)) {\n      return [];\n    }\n    ctx.user.trackedExperiments.add(k);\n  }\n\n  if (ctx.user.enableDevMode && ctx.user.devLogs) {\n    ctx.user.devLogs.push({\n      experiment,\n      result,\n      timestamp: Date.now().toString(),\n      logType: \"experiment\",\n    });\n  }\n\n  const calls: Promise<void>[] = [];\n\n  if (ctx.global.trackingCallback) {\n    const cb = ctx.global.trackingCallback;\n    calls.push(safeCall(() => cb(experiment, result, ctx.user)));\n  }\n  if (ctx.user.trackingCallback) {\n    const cb = ctx.user.trackingCallback;\n    calls.push(safeCall(() => cb(experiment, result)));\n  }\n  if (ctx.global.eventLogger) {\n    const cb = ctx.global.eventLogger;\n    calls.push(\n      safeCall(() =>\n        cb(\n          EVENT_EXPERIMENT_VIEWED,\n          {\n            experimentId: experiment.key,\n            variationId: result.key,\n            hashAttribute: result.hashAttribute,\n            hashValue: result.hashValue,\n          },\n          ctx.user\n        )\n      )\n    );\n  }\n  return calls;\n}\n\nfunction onFeatureUsage(\n  ctx: EvalContext,\n  key: string,\n  ret: FeatureResult<unknown>\n): void {\n  // Only track a feature once, unless the assigned value changed\n  if (ctx.user.trackedFeatureUsage) {\n    const stringifiedValue = JSON.stringify(ret.value);\n    if (ctx.user.trackedFeatureUsage[key] === stringifiedValue) return;\n    ctx.user.trackedFeatureUsage[key] = stringifiedValue;\n\n    if (ctx.user.enableDevMode && ctx.user.devLogs) {\n      ctx.user.devLogs.push({\n        featureKey: key,\n        result: ret,\n        timestamp: Date.now().toString(),\n        logType: \"feature\",\n      });\n    }\n  }\n\n  if (ctx.global.onFeatureUsage) {\n    const cb = ctx.global.onFeatureUsage;\n    safeCall(() => cb(key, ret, ctx.user));\n  }\n  if (ctx.user.onFeatureUsage) {\n    const cb = ctx.user.onFeatureUsage;\n    safeCall(() => cb(key, ret));\n  }\n  if (ctx.global.eventLogger) {\n    const cb = ctx.global.eventLogger;\n    safeCall(() =>\n      cb(\n        EVENT_FEATURE_EVALUATED,\n        {\n          feature: key,\n          source: ret.source,\n          value: ret.value,\n          ruleId: ret.source === \"defaultValue\" ? \"$default\" : ret.ruleId || \"\",\n          variationId: ret.experimentResult ? ret.experimentResult.key : \"\",\n        },\n        ctx.user\n      )\n    );\n  }\n}\n\nexport function evalFeature<V = unknown>(\n  id: string,\n  ctx: EvalContext\n): FeatureResult<V | null> {\n  if (ctx.stack.evaluatedFeatures.has(id)) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\n        `evalFeature: circular dependency detected: ${ctx.stack.id} -> ${id}`,\n        {\n          from: ctx.stack.id,\n          to: id,\n        }\n      );\n    return getFeatureResult(ctx, id, null, \"cyclicPrerequisite\");\n  }\n  ctx.stack.evaluatedFeatures.add(id);\n  ctx.stack.id = id;\n\n  // Global override\n  const forcedValues = getForcedFeatureValues(ctx);\n  if (forcedValues.has(id)) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Global override\", {\n        id,\n        value: forcedValues.get(id),\n      });\n    return getFeatureResult(ctx, id, forcedValues.get(id), \"override\");\n  }\n\n  // Unknown feature id\n  if (!ctx.global.features || !ctx.global.features[id]) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Unknown feature\", { id });\n    return getFeatureResult(ctx, id, null, \"unknownFeature\");\n  }\n\n  // Get the feature\n  const feature: FeatureDefinition<V> = ctx.global.features[id];\n\n  // Loop through the rules\n  if (feature.rules) {\n    const evaluatedFeatures = new Set(ctx.stack.evaluatedFeatures);\n    rules: for (const rule of feature.rules) {\n      // If there are prerequisite flag(s), evaluate them\n      if (rule.parentConditions) {\n        for (const parentCondition of rule.parentConditions) {\n          ctx.stack.evaluatedFeatures = new Set(evaluatedFeatures);\n          const parentResult = evalFeature(parentCondition.id, ctx);\n          // break out for cyclic prerequisites\n          if (parentResult.source === \"cyclicPrerequisite\") {\n            return getFeatureResult(ctx, id, null, \"cyclicPrerequisite\");\n          }\n\n          const evalObj = { value: parentResult.value };\n          const evaled = evalCondition(\n            evalObj,\n            parentCondition.condition || {}\n          );\n          if (!evaled) {\n            // blocking prerequisite eval failed: feature evaluation fails\n            if (parentCondition.gate) {\n              process.env.NODE_ENV !== \"production\" &&\n                ctx.global.log(\"Feature blocked by prerequisite\", { id, rule });\n              return getFeatureResult(ctx, id, null, \"prerequisite\");\n            }\n            // non-blocking prerequisite eval failed: break out of parentConditions loop, jump to the next rule\n            process.env.NODE_ENV !== \"production\" &&\n              ctx.global.log(\n                \"Skip rule because prerequisite evaluation fails\",\n                {\n                  id,\n                  rule,\n                }\n              );\n            continue rules;\n          }\n        }\n      }\n\n      // If there are filters for who is included (e.g. namespaces)\n      if (rule.filters && isFilteredOut(rule.filters, ctx)) {\n        process.env.NODE_ENV !== \"production\" &&\n          ctx.global.log(\"Skip rule because of filters\", {\n            id,\n            rule,\n          });\n        continue;\n      }\n\n      // Feature value is being forced\n      if (\"force\" in rule) {\n        // If it's a conditional rule, skip if the condition doesn't pass\n        if (rule.condition && !conditionPasses(rule.condition, ctx)) {\n          process.env.NODE_ENV !== \"production\" &&\n            ctx.global.log(\"Skip rule because of condition ff\", {\n              id,\n              rule,\n            });\n          continue;\n        }\n\n        // If this is a percentage rollout, skip if not included\n        if (\n          !isIncludedInRollout(\n            ctx,\n            rule.seed || id,\n            rule.hashAttribute,\n            ctx.user.saveStickyBucketAssignmentDoc &&\n              !rule.disableStickyBucketing\n              ? rule.fallbackAttribute\n              : undefined,\n            rule.range,\n            rule.coverage,\n            rule.hashVersion\n          )\n        ) {\n          process.env.NODE_ENV !== \"production\" &&\n            ctx.global.log(\"Skip rule because user not included in rollout\", {\n              id,\n              rule,\n            });\n          continue;\n        }\n\n        process.env.NODE_ENV !== \"production\" &&\n          ctx.global.log(\"Force value from rule\", {\n            id,\n            rule,\n          });\n\n        // If this was a remotely evaluated experiment, fire the tracking callbacks\n        if (rule.tracks) {\n          rule.tracks.forEach((t) => {\n            const calls = onExperimentViewed(ctx, t.experiment, t.result);\n            if (!calls.length && ctx.global.saveDeferredTrack) {\n              ctx.global.saveDeferredTrack({\n                experiment: t.experiment,\n                result: t.result,\n              });\n            }\n          });\n        }\n\n        return getFeatureResult(ctx, id, rule.force as V, \"force\", rule.id);\n      }\n      if (!rule.variations) {\n        process.env.NODE_ENV !== \"production\" &&\n          ctx.global.log(\"Skip invalid rule\", {\n            id,\n            rule,\n          });\n\n        continue;\n      }\n\n      // For experiment rules, run an experiment\n      const exp: Experiment<V> = {\n        variations: rule.variations as [V, V, ...V[]],\n        key: rule.key || id,\n      };\n      if (\"coverage\" in rule) exp.coverage = rule.coverage;\n      if (rule.weights) exp.weights = rule.weights;\n      if (rule.hashAttribute) exp.hashAttribute = rule.hashAttribute;\n      if (rule.fallbackAttribute)\n        exp.fallbackAttribute = rule.fallbackAttribute;\n      if (rule.disableStickyBucketing)\n        exp.disableStickyBucketing = rule.disableStickyBucketing;\n      if (rule.bucketVersion !== undefined)\n        exp.bucketVersion = rule.bucketVersion;\n      if (rule.minBucketVersion !== undefined)\n        exp.minBucketVersion = rule.minBucketVersion;\n      if (rule.namespace) exp.namespace = rule.namespace;\n      if (rule.meta) exp.meta = rule.meta;\n      if (rule.ranges) exp.ranges = rule.ranges;\n      if (rule.name) exp.name = rule.name;\n      if (rule.phase) exp.phase = rule.phase;\n      if (rule.seed) exp.seed = rule.seed;\n      if (rule.hashVersion) exp.hashVersion = rule.hashVersion;\n      if (rule.filters) exp.filters = rule.filters;\n      if (rule.condition) exp.condition = rule.condition;\n\n      // Only return a value if the user is part of the experiment\n      const { result } = runExperiment(exp, id, ctx);\n      ctx.global.onExperimentEval && ctx.global.onExperimentEval(exp, result);\n      if (result.inExperiment && !result.passthrough) {\n        return getFeatureResult(\n          ctx,\n          id,\n          result.value,\n          \"experiment\",\n          rule.id,\n          exp,\n          result\n        );\n      }\n    }\n  }\n\n  process.env.NODE_ENV !== \"production\" &&\n    ctx.global.log(\"Use default value\", {\n      id,\n      value: feature.defaultValue,\n    });\n\n  // Fall back to using the default value\n  return getFeatureResult(\n    ctx,\n    id,\n    feature.defaultValue === undefined ? null : feature.defaultValue,\n    \"defaultValue\"\n  );\n}\n\nexport function runExperiment<T>(\n  experiment: Experiment<T>,\n  featureId: string | null,\n  ctx: EvalContext\n): {\n  result: Result<T>;\n  trackingCall?: Promise<void>;\n} {\n  const key = experiment.key;\n  const numVariations = experiment.variations.length;\n\n  // 1. If experiment has less than 2 variations, return immediately\n  if (numVariations < 2) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Invalid experiment\", { id: key });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 2. If the context is disabled, return immediately\n  if (ctx.global.enabled === false || ctx.user.enabled === false) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Context disabled\", { id: key });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 2.5. Merge in experiment overrides from the context\n  experiment = mergeOverrides(experiment, ctx);\n\n  // 2.6 New, more powerful URL targeting\n  if (\n    experiment.urlPatterns &&\n    !isURLTargeted(ctx.user.url || \"\", experiment.urlPatterns)\n  ) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because of url targeting\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 3. If a variation is forced from a querystring, return the forced variation\n  const qsOverride = getQueryStringOverride(\n    key,\n    ctx.user.url || \"\",\n    numVariations\n  );\n  if (qsOverride !== null) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Force via querystring\", {\n        id: key,\n        variation: qsOverride,\n      });\n    return {\n      result: getExperimentResult(\n        ctx,\n        experiment,\n        qsOverride,\n        false,\n        featureId\n      ),\n    };\n  }\n\n  // 4. If a variation is forced in the context, return the forced variation\n  const forcedVariations = getForcedVariations(ctx);\n  if (key in forcedVariations) {\n    const variation = forcedVariations[key];\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Force via dev tools\", {\n        id: key,\n        variation,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, variation, false, featureId),\n    };\n  }\n\n  // 5. Exclude if a draft experiment or not active\n  if (experiment.status === \"draft\" || experiment.active === false) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because inactive\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 6. Get the hash attribute and return if empty\n  const { hashAttribute, hashValue } = getHashAttribute(\n    ctx,\n    experiment.hashAttribute,\n    ctx.user.saveStickyBucketAssignmentDoc && !experiment.disableStickyBucketing\n      ? experiment.fallbackAttribute\n      : undefined\n  );\n  if (!hashValue) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because missing hashAttribute\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  let assigned = -1;\n\n  let foundStickyBucket = false;\n  let stickyBucketVersionIsBlocked = false;\n  if (\n    ctx.user.saveStickyBucketAssignmentDoc &&\n    !experiment.disableStickyBucketing\n  ) {\n    const { variation, versionIsBlocked } = getStickyBucketVariation({\n      ctx,\n      expKey: experiment.key,\n      expBucketVersion: experiment.bucketVersion,\n      expHashAttribute: experiment.hashAttribute,\n      expFallbackAttribute: experiment.fallbackAttribute,\n      expMinBucketVersion: experiment.minBucketVersion,\n      expMeta: experiment.meta,\n    });\n    foundStickyBucket = variation >= 0;\n    assigned = variation;\n    stickyBucketVersionIsBlocked = !!versionIsBlocked;\n  }\n\n  // Some checks are not needed if we already have a sticky bucket\n  if (!foundStickyBucket) {\n    // 7. Exclude if user is filtered out (used to be called \"namespace\")\n    if (experiment.filters) {\n      if (isFilteredOut(experiment.filters, ctx)) {\n        process.env.NODE_ENV !== \"production\" &&\n          ctx.global.log(\"Skip because of filters\", {\n            id: key,\n          });\n        return {\n          result: getExperimentResult(ctx, experiment, -1, false, featureId),\n        };\n      }\n    } else if (\n      experiment.namespace &&\n      !inNamespace(hashValue, experiment.namespace)\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        ctx.global.log(\"Skip because of namespace\", {\n          id: key,\n        });\n      return {\n        result: getExperimentResult(ctx, experiment, -1, false, featureId),\n      };\n    }\n\n    // 7.5. Exclude if experiment.include returns false or throws\n    if (experiment.include && !isIncluded(experiment.include)) {\n      process.env.NODE_ENV !== \"production\" &&\n        ctx.global.log(\"Skip because of include function\", {\n          id: key,\n        });\n      return {\n        result: getExperimentResult(ctx, experiment, -1, false, featureId),\n      };\n    }\n\n    // 8. Exclude if condition is false\n    if (experiment.condition && !conditionPasses(experiment.condition, ctx)) {\n      process.env.NODE_ENV !== \"production\" &&\n        ctx.global.log(\"Skip because of condition exp\", {\n          id: key,\n        });\n      return {\n        result: getExperimentResult(ctx, experiment, -1, false, featureId),\n      };\n    }\n\n    // 8.05. Exclude if prerequisites are not met\n    if (experiment.parentConditions) {\n      const evaluatedFeatures = new Set(ctx.stack.evaluatedFeatures);\n      for (const parentCondition of experiment.parentConditions) {\n        ctx.stack.evaluatedFeatures = new Set(evaluatedFeatures);\n        const parentResult = evalFeature(parentCondition.id, ctx);\n        // break out for cyclic prerequisites\n        if (parentResult.source === \"cyclicPrerequisite\") {\n          return {\n            result: getExperimentResult(ctx, experiment, -1, false, featureId),\n          };\n        }\n\n        const evalObj = { value: parentResult.value };\n        if (!evalCondition(evalObj, parentCondition.condition || {})) {\n          process.env.NODE_ENV !== \"production\" &&\n            ctx.global.log(\"Skip because prerequisite evaluation fails\", {\n              id: key,\n            });\n          return {\n            result: getExperimentResult(ctx, experiment, -1, false, featureId),\n          };\n        }\n      }\n    }\n\n    // 8.1. Exclude if user is not in a required group\n    if (\n      experiment.groups &&\n      !hasGroupOverlap(experiment.groups as string[], ctx)\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        ctx.global.log(\"Skip because of groups\", {\n          id: key,\n        });\n      return {\n        result: getExperimentResult(ctx, experiment, -1, false, featureId),\n      };\n    }\n  }\n\n  // 8.2. Old style URL targeting\n  if (experiment.url && !urlIsValid(experiment.url as RegExp, ctx)) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because of url\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 9. Get the variation from the sticky bucket or get bucket ranges and choose variation\n  const n = hash(\n    experiment.seed || key,\n    hashValue,\n    experiment.hashVersion || 1\n  );\n  if (n === null) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because of invalid hash version\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  if (!foundStickyBucket) {\n    const ranges =\n      experiment.ranges ||\n      getBucketRanges(\n        numVariations,\n        experiment.coverage === undefined ? 1 : experiment.coverage,\n        experiment.weights\n      );\n    assigned = chooseVariation(n, ranges);\n  }\n\n  // 9.5 Unenroll if any prior sticky buckets are blocked by version\n  if (stickyBucketVersionIsBlocked) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because sticky bucket version is blocked\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(\n        ctx,\n        experiment,\n        -1,\n        false,\n        featureId,\n        undefined,\n        true\n      ),\n    };\n  }\n\n  // 10. Return if not in experiment\n  if (assigned < 0) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because of coverage\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 11. Experiment has a forced variation\n  if (\"force\" in experiment) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Force variation\", {\n        id: key,\n        variation: experiment.force,\n      });\n    return {\n      result: getExperimentResult(\n        ctx,\n        experiment,\n        experiment.force === undefined ? -1 : experiment.force,\n        false,\n        featureId\n      ),\n    };\n  }\n\n  // 12. Exclude if in QA mode\n  if (ctx.global.qaMode || ctx.user.qaMode) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because QA mode\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 12.5. Exclude if experiment is stopped\n  if (experiment.status === \"stopped\") {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because stopped\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 13. Build the result object\n  const result = getExperimentResult(\n    ctx,\n    experiment,\n    assigned,\n    true,\n    featureId,\n    n,\n    foundStickyBucket\n  );\n\n  // 13.5. Persist sticky bucket\n  if (\n    ctx.user.saveStickyBucketAssignmentDoc &&\n    !experiment.disableStickyBucketing\n  ) {\n    const { changed, key: attrKey, doc } = generateStickyBucketAssignmentDoc(\n      ctx,\n      hashAttribute,\n      toString(hashValue),\n      {\n        [getStickyBucketExperimentKey(\n          experiment.key,\n          experiment.bucketVersion\n        )]: result.key,\n      }\n    );\n    if (changed) {\n      // update local docs\n      ctx.user.stickyBucketAssignmentDocs =\n        ctx.user.stickyBucketAssignmentDocs || {};\n      ctx.user.stickyBucketAssignmentDocs[attrKey] = doc;\n      // save doc\n      ctx.user.saveStickyBucketAssignmentDoc(doc);\n    }\n  }\n\n  // 14. Fire the tracking callback(s)\n  // Store the promise in case we're awaiting it (ex: browser url redirects)\n  const trackingCalls = onExperimentViewed(ctx, experiment, result);\n  if (trackingCalls.length === 0 && ctx.global.saveDeferredTrack) {\n    ctx.global.saveDeferredTrack({\n      experiment,\n      result,\n    });\n  }\n  const trackingCall = !trackingCalls.length\n    ? undefined\n    : trackingCalls.length === 1\n    ? trackingCalls[0]\n    : Promise.all(trackingCalls).then(() => {});\n\n  // 14.1 Keep track of completed changeIds\n  \"changeId\" in experiment &&\n    experiment.changeId &&\n    ctx.global.recordChangeId &&\n    ctx.global.recordChangeId(experiment.changeId as string);\n\n  // 15. Return the result\n  process.env.NODE_ENV !== \"production\" &&\n    ctx.global.log(\"In experiment\", {\n      id: key,\n      variation: result.variationId,\n    });\n  return { result, trackingCall };\n}\n\nfunction getFeatureResult<T>(\n  ctx: EvalContext,\n  key: string,\n  value: T,\n  source: FeatureResultSource,\n  ruleId?: string,\n  experiment?: Experiment<T>,\n  result?: Result<T>\n): FeatureResult<T> {\n  const ret: FeatureResult = {\n    value,\n    on: !!value,\n    off: !value,\n    source,\n    ruleId: ruleId || \"\",\n  };\n  if (experiment) ret.experiment = experiment;\n  if (result) ret.experimentResult = result;\n\n  // Track the usage of this feature in real-time\n  if (source !== \"override\") {\n    onFeatureUsage(ctx, key, ret);\n  }\n\n  return ret;\n}\n\nfunction getAttributes(ctx: EvalContext) {\n  return {\n    ...ctx.user.attributes,\n    ...ctx.user.attributeOverrides,\n  };\n}\n\nfunction conditionPasses(\n  condition: ConditionInterface,\n  ctx: EvalContext\n): boolean {\n  return evalCondition(\n    getAttributes(ctx),\n    condition,\n    ctx.global.savedGroups || {}\n  );\n}\n\nfunction isFilteredOut(filters: Filter[], ctx: EvalContext): boolean {\n  return filters.some((filter) => {\n    const { hashValue } = getHashAttribute(ctx, filter.attribute);\n    if (!hashValue) return true;\n    const n = hash(filter.seed, hashValue, filter.hashVersion || 2);\n    if (n === null) return true;\n    return !filter.ranges.some((r) => inRange(n, r));\n  });\n}\n\nfunction isIncludedInRollout(\n  ctx: EvalContext,\n  seed: string,\n  hashAttribute: string | undefined,\n  fallbackAttribute: string | undefined,\n  range: VariationRange | undefined,\n  coverage: number | undefined,\n  hashVersion: number | undefined\n): boolean {\n  if (!range && coverage === undefined) return true;\n\n  if (!range && coverage === 0) return false;\n\n  const { hashValue } = getHashAttribute(ctx, hashAttribute, fallbackAttribute);\n  if (!hashValue) {\n    return false;\n  }\n\n  const n = hash(seed, hashValue, hashVersion || 1);\n  if (n === null) return false;\n\n  return range\n    ? inRange(n, range)\n    : coverage !== undefined\n    ? n <= coverage\n    : true;\n}\n\nexport function getExperimentResult<T>(\n  ctx: EvalContext,\n  experiment: Experiment<T>,\n  variationIndex: number,\n  hashUsed: boolean,\n  featureId: string | null,\n  bucket?: number,\n  stickyBucketUsed?: boolean\n): Result<T> {\n  let inExperiment = true;\n  // If assigned variation is not valid, use the baseline and mark the user as not in the experiment\n  if (variationIndex < 0 || variationIndex >= experiment.variations.length) {\n    variationIndex = 0;\n    inExperiment = false;\n  }\n\n  const { hashAttribute, hashValue } = getHashAttribute(\n    ctx,\n    experiment.hashAttribute,\n    ctx.user.saveStickyBucketAssignmentDoc && !experiment.disableStickyBucketing\n      ? experiment.fallbackAttribute\n      : undefined\n  );\n\n  const meta: Partial<VariationMeta> = experiment.meta\n    ? experiment.meta[variationIndex]\n    : {};\n\n  const res: Result<T> = {\n    key: meta.key || \"\" + variationIndex,\n    featureId,\n    inExperiment,\n    hashUsed,\n    variationId: variationIndex,\n    value: experiment.variations[variationIndex],\n    hashAttribute,\n    hashValue,\n    stickyBucketUsed: !!stickyBucketUsed,\n  };\n\n  if (meta.name) res.name = meta.name;\n  if (bucket !== undefined) res.bucket = bucket;\n  if (meta.passthrough) res.passthrough = meta.passthrough;\n\n  return res;\n}\n\nfunction mergeOverrides<T>(\n  experiment: Experiment<T>,\n  ctx: EvalContext\n): Experiment<T> {\n  const key = experiment.key;\n  const o = ctx.global.overrides;\n  if (o && o[key]) {\n    experiment = Object.assign({}, experiment, o[key]);\n    if (typeof experiment.url === \"string\") {\n      experiment.url = getUrlRegExp(\n        // eslint-disable-next-line\n        experiment.url as any\n      );\n    }\n  }\n\n  return experiment;\n}\n\nexport function getHashAttribute(\n  ctx: EvalContext,\n  attr?: string,\n  fallback?: string\n) {\n  let hashAttribute = attr || \"id\";\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  let hashValue: any = \"\";\n\n  const attributes = getAttributes(ctx);\n\n  if (attributes[hashAttribute]) {\n    hashValue = attributes[hashAttribute];\n  }\n\n  // if no match, try fallback\n  if (!hashValue && fallback) {\n    if (attributes[fallback]) {\n      hashValue = attributes[fallback];\n    }\n    if (hashValue) {\n      hashAttribute = fallback;\n    }\n  }\n\n  return { hashAttribute, hashValue };\n}\n\nfunction urlIsValid(urlRegex: RegExp, ctx: EvalContext): boolean {\n  const url = ctx.user.url;\n  if (!url) return false;\n\n  const pathOnly = url.replace(/^https?:\\/\\//, \"\").replace(/^[^/]*\\//, \"/\");\n\n  if (urlRegex.test(url)) return true;\n  if (urlRegex.test(pathOnly)) return true;\n  return false;\n}\n\nfunction hasGroupOverlap(expGroups: string[], ctx: EvalContext): boolean {\n  const groups = ctx.global.groups || {};\n  for (let i = 0; i < expGroups.length; i++) {\n    if (groups[expGroups[i]]) return true;\n  }\n  return false;\n}\n\nfunction getStickyBucketVariation({\n  ctx,\n  expKey,\n  expBucketVersion,\n  expHashAttribute,\n  expFallbackAttribute,\n  expMinBucketVersion,\n  expMeta,\n}: {\n  ctx: EvalContext;\n  expKey: string;\n  expBucketVersion?: number;\n  expHashAttribute?: string;\n  expFallbackAttribute?: string;\n  expMinBucketVersion?: number;\n  expMeta?: VariationMeta[];\n}): {\n  variation: number;\n  versionIsBlocked?: boolean;\n} {\n  expBucketVersion = expBucketVersion || 0;\n  expMinBucketVersion = expMinBucketVersion || 0;\n  expHashAttribute = expHashAttribute || \"id\";\n  expMeta = expMeta || [];\n  const id = getStickyBucketExperimentKey(expKey, expBucketVersion);\n  const assignments = getStickyBucketAssignments(\n    ctx,\n    expHashAttribute,\n    expFallbackAttribute\n  );\n\n  // users with any blocked bucket version (0 to minExperimentBucketVersion) are excluded from the test\n  if (expMinBucketVersion > 0) {\n    for (let i = 0; i <= expMinBucketVersion; i++) {\n      const blockedKey = getStickyBucketExperimentKey(expKey, i);\n      if (assignments[blockedKey] !== undefined) {\n        return {\n          variation: -1,\n          versionIsBlocked: true,\n        };\n      }\n    }\n  }\n  const variationKey = assignments[id];\n  if (variationKey === undefined)\n    // no assignment found\n    return { variation: -1 };\n  const variation = expMeta.findIndex((m) => m.key === variationKey);\n  if (variation < 0)\n    // invalid assignment, treat as \"no assignment found\"\n    return { variation: -1 };\n\n  return { variation };\n}\n\nfunction getStickyBucketExperimentKey(\n  experimentKey: string,\n  experimentBucketVersion?: number\n): StickyExperimentKey {\n  experimentBucketVersion = experimentBucketVersion || 0;\n  return `${experimentKey}__${experimentBucketVersion}`;\n}\n\nexport function getStickyBucketAttributeKey(\n  attributeName: string,\n  attributeValue: string\n): StickyAttributeKey {\n  return `${attributeName}||${attributeValue}`;\n}\n\nfunction getStickyBucketAssignments(\n  ctx: EvalContext,\n  expHashAttribute: string,\n  expFallbackAttribute?: string\n): StickyAssignments {\n  if (!ctx.user.stickyBucketAssignmentDocs) return {};\n  const { hashAttribute, hashValue } = getHashAttribute(ctx, expHashAttribute);\n  const hashKey = getStickyBucketAttributeKey(\n    hashAttribute,\n    toString(hashValue)\n  );\n\n  const {\n    hashAttribute: fallbackAttribute,\n    hashValue: fallbackValue,\n  } = getHashAttribute(ctx, expFallbackAttribute);\n  const fallbackKey = fallbackValue\n    ? getStickyBucketAttributeKey(fallbackAttribute, toString(fallbackValue))\n    : null;\n\n  const assignments: StickyAssignments = {};\n  if (fallbackKey && ctx.user.stickyBucketAssignmentDocs[fallbackKey]) {\n    Object.assign(\n      assignments,\n      ctx.user.stickyBucketAssignmentDocs[fallbackKey].assignments || {}\n    );\n  }\n  if (ctx.user.stickyBucketAssignmentDocs[hashKey]) {\n    Object.assign(\n      assignments,\n      ctx.user.stickyBucketAssignmentDocs[hashKey].assignments || {}\n    );\n  }\n  return assignments;\n}\n\nfunction generateStickyBucketAssignmentDoc(\n  ctx: EvalContext,\n  attributeName: string,\n  attributeValue: string,\n  assignments: StickyAssignments\n): {\n  key: StickyAttributeKey;\n  doc: StickyAssignmentsDocument;\n  changed: boolean;\n} {\n  const key = getStickyBucketAttributeKey(attributeName, attributeValue);\n  const existingAssignments =\n    ctx.user.stickyBucketAssignmentDocs &&\n    ctx.user.stickyBucketAssignmentDocs[key]\n      ? ctx.user.stickyBucketAssignmentDocs[key].assignments || {}\n      : {};\n  const newAssignments = { ...existingAssignments, ...assignments };\n  const changed =\n    JSON.stringify(existingAssignments) !== JSON.stringify(newAssignments);\n\n  return {\n    key,\n    doc: {\n      attributeName,\n      attributeValue,\n      assignments: newAssignments,\n    },\n    changed,\n  };\n}\n\nfunction deriveStickyBucketIdentifierAttributes(\n  ctx: EvalContext,\n  data?: FeatureApiResponse\n) {\n  const attributes = new Set<string>();\n  const features =\n    data && data.features ? data.features : ctx.global.features || {};\n  const experiments =\n    data && data.experiments ? data.experiments : ctx.global.experiments || [];\n  Object.keys(features).forEach((id) => {\n    const feature = features[id];\n    if (feature.rules) {\n      for (const rule of feature.rules) {\n        if (rule.variations) {\n          attributes.add(rule.hashAttribute || \"id\");\n          if (rule.fallbackAttribute) {\n            attributes.add(rule.fallbackAttribute);\n          }\n        }\n      }\n    }\n  });\n  experiments.map((experiment) => {\n    attributes.add(experiment.hashAttribute || \"id\");\n    if (experiment.fallbackAttribute) {\n      attributes.add(experiment.fallbackAttribute);\n    }\n  });\n  return Array.from(attributes);\n}\n\nexport async function getAllStickyBucketAssignmentDocs(\n  ctx: EvalContext,\n  stickyBucketService: StickyBucketService,\n  data?: FeatureApiResponse\n) {\n  const attributes = getStickyBucketAttributes(ctx, data);\n  return stickyBucketService.getAllAssignments(attributes);\n}\n\nexport function getStickyBucketAttributes(\n  ctx: EvalContext,\n  data?: FeatureApiResponse\n): Record<string, string> {\n  const attributes: Record<string, string> = {};\n  const stickyBucketIdentifierAttributes = deriveStickyBucketIdentifierAttributes(\n    ctx,\n    data\n  );\n  stickyBucketIdentifierAttributes.forEach((attr) => {\n    const { hashValue } = getHashAttribute(ctx, attr);\n    attributes[attr] = toString(hashValue);\n  });\n  return attributes;\n}\n\nexport async function decryptPayload(\n  data: FeatureApiResponse,\n  decryptionKey: string | undefined,\n  subtle?: SubtleCrypto\n): Promise<FeatureApiResponse> {\n  data = { ...data };\n  if (data.encryptedFeatures) {\n    try {\n      data.features = JSON.parse(\n        await decrypt(data.encryptedFeatures, decryptionKey, subtle)\n      );\n    } catch (e) {\n      console.error(e);\n    }\n    delete data.encryptedFeatures;\n  }\n  if (data.encryptedExperiments) {\n    try {\n      data.experiments = JSON.parse(\n        await decrypt(data.encryptedExperiments, decryptionKey, subtle)\n      );\n    } catch (e) {\n      console.error(e);\n    }\n    delete data.encryptedExperiments;\n  }\n  if (data.encryptedSavedGroups) {\n    try {\n      data.savedGroups = JSON.parse(\n        await decrypt(data.encryptedSavedGroups, decryptionKey, subtle)\n      );\n    } catch (e) {\n      console.error(e);\n    }\n    delete data.encryptedSavedGroups;\n  }\n  return data;\n}\n\nexport function getApiHosts(\n  options: Options | ClientOptions\n): {\n  apiHost: string;\n  streamingHost: string;\n  apiRequestHeaders?: Record<string, string>;\n  streamingHostRequestHeaders?: Record<string, string>;\n} {\n  const defaultHost = options.apiHost || \"https://cdn.growthbook.io\";\n  return {\n    apiHost: defaultHost.replace(/\\/*$/, \"\"),\n    streamingHost: (options.streamingHost || defaultHost).replace(/\\/*$/, \"\"),\n    apiRequestHeaders: options.apiHostRequestHeaders,\n    streamingHostRequestHeaders: options.streamingHostRequestHeaders,\n  };\n}\n\nexport function getExperimentDedupeKey(\n  experiment: Experiment<unknown>,\n  result: Result<unknown>\n) {\n  return (\n    result.hashAttribute +\n    result.hashValue +\n    experiment.key +\n    result.variationId\n  );\n}\n","import mutate, { DeclarativeMutation } from \"dom-mutator\";\nimport type {\n  ApiHost,\n  Attributes,\n  AutoExperiment,\n  AutoExperimentVariation,\n  ClientKey,\n  Options,\n  Experiment,\n  FeatureApiResponse,\n  FeatureDefinition,\n  FeatureResult,\n  LoadFeaturesOptions,\n  RefreshFeaturesOptions,\n  RenderFunction,\n  Result,\n  SubscriptionFunction,\n  TrackingCallback,\n  TrackingData,\n  WidenPrimitives,\n  EvalContext,\n  InitOptions,\n  InitResponse,\n  InitSyncOptions,\n  PrefetchOptions,\n  GlobalContext,\n  UserContext,\n  StickyAssignmentsDocument,\n  EventLogger,\n  LogUnion,\n} from \"./types/growthbook\";\nimport {\n  decrypt,\n  getAutoExperimentChangeType,\n  isURLTargeted,\n  loadSDKVersion,\n  mergeQueryStrings,\n  promiseTimeout,\n} from \"./util\";\nimport {\n  configureCache,\n  refreshFeatures,\n  startStreaming,\n  unsubscribe,\n} from \"./feature-repository\";\nimport {\n  runExperiment,\n  evalFeature as _evalFeature,\n  getExperimentResult,\n  getAllStickyBucketAssignmentDocs,\n  decryptPayload,\n  getApiHosts,\n  getExperimentDedupeKey,\n  getStickyBucketAttributes,\n} from \"./core\";\nimport { StickyBucketServiceSync } from \"./sticky-bucket-service\";\n\nconst isBrowser =\n  typeof window !== \"undefined\" && typeof document !== \"undefined\";\n\nconst SDK_VERSION = loadSDKVersion();\n\nexport class GrowthBook<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  AppFeatures extends Record<string, any> = Record<string, any>\n> {\n  // context is technically private, but some tools depend on it so we can't mangle the name\n  private context: Options;\n  public debug: boolean;\n  public ready: boolean;\n  public version: string;\n  public logs: Array<LogUnion>;\n\n  // Properties and methods that start with \"_\" are mangled by Terser (saves ~150 bytes)\n  private _options: Options;\n  private _renderer: null | RenderFunction;\n  private _redirectedUrl: string;\n  private _trackedExperiments: Set<string>;\n  private _completedChangeIds: Set<string>;\n  private _trackedFeatures: Record<string, string>;\n  private _subscriptions: Set<SubscriptionFunction>;\n  private _assigned: Map<\n    string,\n    {\n      // eslint-disable-next-line\n      experiment: Experiment<any>;\n      // eslint-disable-next-line\n      result: Result<any>;\n    }\n  >;\n  private _activeAutoExperiments: Map<\n    AutoExperiment,\n    { valueHash: string; undo: () => void }\n  >;\n  private _triggeredExpKeys: Set<string>;\n  private _initialized: boolean;\n  private _deferredTrackingCalls: Map<string, TrackingData>;\n  private _saveStickyBucketAssignmentDoc:\n    | undefined\n    | ((doc: StickyAssignmentsDocument) => Promise<unknown>);\n\n  private _payload: FeatureApiResponse | undefined;\n  private _decryptedPayload: FeatureApiResponse | undefined;\n  private _destroyCallbacks: (() => void)[];\n\n  private _autoExperimentsAllowed: boolean;\n  private _destroyed?: boolean;\n\n  constructor(options?: Options) {\n    options = options || {};\n    // These properties are all initialized in the constructor instead of above\n    // This saves ~80 bytes in the final output\n    this.version = SDK_VERSION;\n    this._options = this.context = options;\n    this._renderer = options.renderer || null;\n    this._trackedExperiments = new Set();\n    this._completedChangeIds = new Set();\n    this._trackedFeatures = {};\n    this.debug = !!options.debug;\n    this._subscriptions = new Set();\n    this.ready = false;\n    this._assigned = new Map();\n    this._activeAutoExperiments = new Map();\n    this._triggeredExpKeys = new Set();\n    this._initialized = false;\n    this._redirectedUrl = \"\";\n    this._deferredTrackingCalls = new Map();\n    this._autoExperimentsAllowed = !options.disableExperimentsOnLoad;\n    this._destroyCallbacks = [];\n    this.logs = [];\n\n    this.log = this.log.bind(this);\n    this._saveDeferredTrack = this._saveDeferredTrack.bind(this);\n    this._fireSubscriptions = this._fireSubscriptions.bind(this);\n    this._recordChangedId = this._recordChangedId.bind(this);\n\n    if (options.remoteEval) {\n      if (options.decryptionKey) {\n        throw new Error(\"Encryption is not available for remoteEval\");\n      }\n      if (!options.clientKey) {\n        throw new Error(\"Missing clientKey\");\n      }\n      let isGbHost = false;\n      try {\n        isGbHost = !!new URL(options.apiHost || \"\").hostname.match(\n          /growthbook\\.io$/i\n        );\n      } catch (e) {\n        // ignore invalid URLs\n      }\n      if (isGbHost) {\n        throw new Error(\"Cannot use remoteEval on GrowthBook Cloud\");\n      }\n    } else {\n      if (options.cacheKeyAttributes) {\n        throw new Error(\"cacheKeyAttributes are only used for remoteEval\");\n      }\n    }\n\n    if (options.stickyBucketService) {\n      const s = options.stickyBucketService;\n      this._saveStickyBucketAssignmentDoc = (doc) => {\n        return s.saveAssignments(doc);\n      };\n    }\n\n    if (options.plugins) {\n      for (const plugin of options.plugins) {\n        plugin(this);\n      }\n    }\n\n    if (options.features) {\n      this.ready = true;\n    }\n\n    if (isBrowser && options.enableDevMode) {\n      window._growthbook = this;\n      document.dispatchEvent(new Event(\"gbloaded\"));\n    }\n\n    if (options.experiments) {\n      this.ready = true;\n      this._updateAllAutoExperiments();\n    }\n\n    // Hydrate sticky bucket service\n    if (\n      this._options.stickyBucketService &&\n      this._options.stickyBucketAssignmentDocs\n    ) {\n      for (const key in this._options.stickyBucketAssignmentDocs) {\n        const doc = this._options.stickyBucketAssignmentDocs[key];\n        if (doc) {\n          this._options.stickyBucketService.saveAssignments(doc).catch(() => {\n            // Ignore hydration errors\n          });\n        }\n      }\n    }\n\n    // Legacy - passing in features/experiments into the constructor instead of using init\n    if (this.ready) {\n      this.refreshStickyBuckets(this.getPayload());\n    }\n  }\n\n  public async setPayload(payload: FeatureApiResponse): Promise<void> {\n    this._payload = payload;\n    const data = await decryptPayload(payload, this._options.decryptionKey);\n    this._decryptedPayload = data;\n    await this.refreshStickyBuckets(data);\n    if (data.features) {\n      this._options.features = data.features;\n    }\n    if (data.savedGroups) {\n      this._options.savedGroups = data.savedGroups;\n    }\n    if (data.experiments) {\n      this._options.experiments = data.experiments;\n      this._updateAllAutoExperiments();\n    }\n    this.ready = true;\n    this._render();\n  }\n\n  public initSync(options: InitSyncOptions): GrowthBook {\n    this._initialized = true;\n\n    const payload = options.payload;\n\n    if (payload.encryptedExperiments || payload.encryptedFeatures) {\n      throw new Error(\"initSync does not support encrypted payloads\");\n    }\n\n    if (\n      this._options.stickyBucketService &&\n      !this._options.stickyBucketAssignmentDocs\n    ) {\n      this._options.stickyBucketAssignmentDocs = this.generateStickyBucketAssignmentDocsSync(\n        this._options.stickyBucketService as StickyBucketServiceSync,\n        payload\n      );\n    }\n\n    this._payload = payload;\n    this._decryptedPayload = payload;\n    if (payload.features) {\n      this._options.features = payload.features;\n    }\n    if (payload.experiments) {\n      this._options.experiments = payload.experiments;\n      this._updateAllAutoExperiments();\n    }\n\n    this.ready = true;\n\n    startStreaming(this, options);\n\n    return this;\n  }\n\n  public async init(options?: InitOptions): Promise<InitResponse> {\n    this._initialized = true;\n    options = options || {};\n\n    if (options.cacheSettings) {\n      configureCache(options.cacheSettings);\n    }\n\n    if (options.payload) {\n      await this.setPayload(options.payload);\n      startStreaming(this, options);\n      return {\n        success: true,\n        source: \"init\",\n      };\n    } else {\n      const { data, ...res } = await this._refresh({\n        ...options,\n        allowStale: true,\n      });\n      startStreaming(this, options);\n      await this.setPayload(data || {});\n      return res;\n    }\n  }\n\n  /** @deprecated Use {@link init} */\n  public async loadFeatures(options?: LoadFeaturesOptions): Promise<void> {\n    options = options || {};\n    await this.init({\n      skipCache: options.skipCache,\n      timeout: options.timeout,\n      streaming:\n        (this._options.backgroundSync ?? true) &&\n        (options.autoRefresh || this._options.subscribeToChanges),\n    });\n  }\n\n  public async refreshFeatures(\n    options?: RefreshFeaturesOptions\n  ): Promise<void> {\n    const res = await this._refresh({\n      ...(options || {}),\n      allowStale: false,\n    });\n    if (res.data) {\n      await this.setPayload(res.data);\n    }\n  }\n\n  public getApiInfo(): [ApiHost, ClientKey] {\n    return [this.getApiHosts().apiHost, this.getClientKey()];\n  }\n  public getApiHosts() {\n    return getApiHosts(this._options);\n  }\n  public getClientKey(): string {\n    return this._options.clientKey || \"\";\n  }\n  public getPayload(): FeatureApiResponse {\n    return (\n      this._payload || {\n        features: this.getFeatures(),\n        experiments: this.getExperiments(),\n      }\n    );\n  }\n  public getDecryptedPayload(): FeatureApiResponse {\n    return this._decryptedPayload || this.getPayload();\n  }\n\n  public isRemoteEval(): boolean {\n    return this._options.remoteEval || false;\n  }\n\n  public getCacheKeyAttributes(): (keyof Attributes)[] | undefined {\n    return this._options.cacheKeyAttributes;\n  }\n\n  private async _refresh({\n    timeout,\n    skipCache,\n    allowStale,\n    streaming,\n  }: RefreshFeaturesOptions & {\n    allowStale?: boolean;\n    streaming?: boolean;\n  }) {\n    if (!this._options.clientKey) {\n      throw new Error(\"Missing clientKey\");\n    }\n    // Trigger refresh in feature repository\n    return refreshFeatures({\n      instance: this,\n      timeout,\n      skipCache: skipCache || this._options.disableCache,\n      allowStale,\n      backgroundSync: streaming ?? this._options.backgroundSync ?? true,\n    });\n  }\n\n  private _render() {\n    if (this._renderer) {\n      try {\n        this._renderer();\n      } catch (e) {\n        console.error(\"Failed to render\", e);\n      }\n    }\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public setFeatures(features: Record<string, FeatureDefinition>) {\n    this._options.features = features;\n    this.ready = true;\n    this._render();\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public async setEncryptedFeatures(\n    encryptedString: string,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto\n  ): Promise<void> {\n    const featuresJSON = await decrypt(\n      encryptedString,\n      decryptionKey || this._options.decryptionKey,\n      subtle\n    );\n    this.setFeatures(\n      JSON.parse(featuresJSON) as Record<string, FeatureDefinition>\n    );\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public setExperiments(experiments: AutoExperiment[]): void {\n    this._options.experiments = experiments;\n    this.ready = true;\n    this._updateAllAutoExperiments();\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public async setEncryptedExperiments(\n    encryptedString: string,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto\n  ): Promise<void> {\n    const experimentsJSON = await decrypt(\n      encryptedString,\n      decryptionKey || this._options.decryptionKey,\n      subtle\n    );\n    this.setExperiments(JSON.parse(experimentsJSON) as AutoExperiment[]);\n  }\n\n  public async setAttributes(attributes: Attributes) {\n    this._options.attributes = attributes;\n    if (this._options.stickyBucketService) {\n      await this.refreshStickyBuckets();\n    }\n    if (this._options.remoteEval) {\n      await this._refreshForRemoteEval();\n      return;\n    }\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n\n  public async updateAttributes(attributes: Attributes) {\n    return this.setAttributes({ ...this._options.attributes, ...attributes });\n  }\n\n  public async setAttributeOverrides(overrides: Attributes) {\n    this._options.attributeOverrides = overrides;\n    if (this._options.stickyBucketService) {\n      await this.refreshStickyBuckets();\n    }\n    if (this._options.remoteEval) {\n      await this._refreshForRemoteEval();\n      return;\n    }\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n\n  public async setForcedVariations(vars: Record<string, number>) {\n    this._options.forcedVariations = vars || {};\n    if (this._options.remoteEval) {\n      await this._refreshForRemoteEval();\n      return;\n    }\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n\n  // eslint-disable-next-line\n  public setForcedFeatures(map: Map<string, any>) {\n    this._options.forcedFeatureValues = map;\n    this._render();\n  }\n\n  public async setURL(url: string) {\n    if (url === this._options.url) return;\n    this._options.url = url;\n    this._redirectedUrl = \"\";\n    if (this._options.remoteEval) {\n      await this._refreshForRemoteEval();\n      this._updateAllAutoExperiments(true);\n      return;\n    }\n    this._updateAllAutoExperiments(true);\n  }\n\n  public getAttributes() {\n    return { ...this._options.attributes, ...this._options.attributeOverrides };\n  }\n\n  public getForcedVariations() {\n    return this._options.forcedVariations || {};\n  }\n\n  public getForcedFeatures() {\n    // eslint-disable-next-line\n    return this._options.forcedFeatureValues || new Map<string, any>();\n  }\n\n  public getStickyBucketAssignmentDocs() {\n    return this._options.stickyBucketAssignmentDocs || {};\n  }\n\n  public getUrl() {\n    return this._options.url || \"\";\n  }\n\n  public getFeatures() {\n    return this._options.features || {};\n  }\n\n  public getExperiments() {\n    return this._options.experiments || [];\n  }\n\n  public getCompletedChangeIds(): string[] {\n    return Array.from(this._completedChangeIds);\n  }\n\n  public subscribe(cb: SubscriptionFunction): () => void {\n    this._subscriptions.add(cb);\n    return () => {\n      this._subscriptions.delete(cb);\n    };\n  }\n\n  private async _refreshForRemoteEval() {\n    if (!this._options.remoteEval) return;\n    if (!this._initialized) return;\n    const res = await this._refresh({\n      allowStale: false,\n    });\n    if (res.data) {\n      await this.setPayload(res.data);\n    }\n  }\n\n  public getAllResults() {\n    return new Map(this._assigned);\n  }\n\n  public onDestroy(cb: () => void) {\n    this._destroyCallbacks.push(cb);\n  }\n\n  public isDestroyed() {\n    return !!this._destroyed;\n  }\n\n  public destroy() {\n    this._destroyed = true;\n\n    // Custom callbacks\n    // Do this first in case it needs access to the below data that is cleared\n    this._destroyCallbacks.forEach((cb) => {\n      try {\n        cb();\n      } catch (e) {\n        console.error(e);\n      }\n    });\n\n    // Release references to save memory\n    this._subscriptions.clear();\n    this._assigned.clear();\n    this._trackedExperiments.clear();\n    this._completedChangeIds.clear();\n    this._deferredTrackingCalls.clear();\n    this._trackedFeatures = {};\n    this._destroyCallbacks = [];\n    this._payload = undefined;\n    this._saveStickyBucketAssignmentDoc = undefined;\n    unsubscribe(this);\n    this.logs = [];\n\n    if (isBrowser && window._growthbook === this) {\n      delete window._growthbook;\n    }\n\n    // Undo any active auto experiments\n    this._activeAutoExperiments.forEach((exp) => {\n      exp.undo();\n    });\n    this._activeAutoExperiments.clear();\n    this._triggeredExpKeys.clear();\n  }\n\n  public setRenderer(renderer: null | RenderFunction) {\n    this._renderer = renderer;\n  }\n\n  public forceVariation(key: string, variation: number) {\n    this._options.forcedVariations = this._options.forcedVariations || {};\n    this._options.forcedVariations[key] = variation;\n    if (this._options.remoteEval) {\n      this._refreshForRemoteEval();\n      return;\n    }\n    this._updateAllAutoExperiments();\n    this._render();\n  }\n\n  public run<T>(experiment: Experiment<T>): Result<T> {\n    const { result } = runExperiment(experiment, null, this._getEvalContext());\n    this._fireSubscriptions(experiment, result);\n    return result;\n  }\n\n  public triggerExperiment(key: string) {\n    this._triggeredExpKeys.add(key);\n    if (!this._options.experiments) return null;\n    const experiments = this._options.experiments.filter(\n      (exp) => exp.key === key\n    );\n    return experiments\n      .map((exp) => {\n        return this._runAutoExperiment(exp);\n      })\n      .filter((res) => res !== null);\n  }\n\n  public triggerAutoExperiments() {\n    this._autoExperimentsAllowed = true;\n    this._updateAllAutoExperiments(true);\n  }\n\n  private _getEvalContext(): EvalContext {\n    return {\n      user: this._getUserContext(),\n      global: this._getGlobalContext(),\n      stack: {\n        evaluatedFeatures: new Set(),\n      },\n    };\n  }\n\n  private _getUserContext(): UserContext {\n    return {\n      attributes: this._options.user\n        ? {\n            ...this._options.user,\n            ...this._options.attributes,\n          }\n        : this._options.attributes,\n      enableDevMode: this._options.enableDevMode,\n      blockedChangeIds: this._options.blockedChangeIds,\n      stickyBucketAssignmentDocs: this._options.stickyBucketAssignmentDocs,\n      url: this._getContextUrl(),\n      forcedVariations: this._options.forcedVariations,\n      forcedFeatureValues: this._options.forcedFeatureValues,\n      attributeOverrides: this._options.attributeOverrides,\n      saveStickyBucketAssignmentDoc: this._saveStickyBucketAssignmentDoc,\n      trackingCallback: this._options.trackingCallback,\n      onFeatureUsage: this._options.onFeatureUsage,\n      devLogs: this.logs,\n      trackedExperiments: this._trackedExperiments,\n      trackedFeatureUsage: this._trackedFeatures,\n    };\n  }\n  private _getGlobalContext(): GlobalContext {\n    return {\n      features: this._options.features,\n      experiments: this._options.experiments,\n      log: this.log,\n      enabled: this._options.enabled,\n      qaMode: this._options.qaMode,\n      savedGroups: this._options.savedGroups,\n      groups: this._options.groups,\n      overrides: this._options.overrides,\n      onExperimentEval:\n        this._subscriptions.size > 0 ? this._fireSubscriptions : undefined,\n      recordChangeId: this._recordChangedId,\n      saveDeferredTrack: this._saveDeferredTrack,\n      eventLogger: this._options.eventLogger,\n    };\n  }\n\n  private _runAutoExperiment(experiment: AutoExperiment, forceRerun?: boolean) {\n    const existing = this._activeAutoExperiments.get(experiment);\n\n    // If this is a manual experiment and it's not already running, skip\n    if (\n      experiment.manual &&\n      !this._triggeredExpKeys.has(experiment.key) &&\n      !existing\n    )\n      return null;\n\n    // Check if this particular experiment is blocked by options settings\n    // For example, if all visualEditor experiments are disabled\n    const isBlocked = this._isAutoExperimentBlockedByContext(experiment);\n    if (isBlocked) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Auto experiment blocked\", { id: experiment.key });\n    }\n\n    let result: Result<AutoExperimentVariation> | undefined;\n    let trackingCall: Promise<void> | undefined;\n    // Run the experiment (if blocked exclude)\n    if (isBlocked) {\n      result = getExperimentResult(\n        this._getEvalContext(),\n        experiment,\n        -1,\n        false,\n        \"\"\n      );\n    } else {\n      ({ result, trackingCall } = runExperiment(\n        experiment,\n        null,\n        this._getEvalContext()\n      ));\n      this._fireSubscriptions(experiment, result);\n    }\n\n    // A hash to quickly tell if the assigned value changed\n    const valueHash = JSON.stringify(result.value);\n\n    // If the changes are already active, no need to re-apply them\n    if (\n      !forceRerun &&\n      result.inExperiment &&\n      existing &&\n      existing.valueHash === valueHash\n    ) {\n      return result;\n    }\n\n    // Undo any existing changes\n    if (existing) this._undoActiveAutoExperiment(experiment);\n\n    // Apply new changes\n    if (result.inExperiment) {\n      const changeType = getAutoExperimentChangeType(experiment);\n\n      if (\n        changeType === \"redirect\" &&\n        result.value.urlRedirect &&\n        experiment.urlPatterns\n      ) {\n        const url = experiment.persistQueryString\n          ? mergeQueryStrings(this._getContextUrl(), result.value.urlRedirect)\n          : result.value.urlRedirect;\n\n        if (isURLTargeted(url, experiment.urlPatterns)) {\n          this.log(\n            \"Skipping redirect because original URL matches redirect URL\",\n            {\n              id: experiment.key,\n            }\n          );\n          return result;\n        }\n        this._redirectedUrl = url;\n        const { navigate, delay } = this._getNavigateFunction();\n        if (navigate) {\n          if (isBrowser) {\n            // Wait for the possibly-async tracking callback, bound by min and max delays\n            Promise.all([\n              ...(trackingCall\n                ? [\n                    promiseTimeout(\n                      trackingCall,\n                      this._options.maxNavigateDelay ?? 1000\n                    ),\n                  ]\n                : []),\n              new Promise((resolve) =>\n                window.setTimeout(resolve, this._options.navigateDelay ?? delay)\n              ),\n            ]).then(() => {\n              try {\n                navigate(url);\n              } catch (e) {\n                console.error(e);\n              }\n            });\n          } else {\n            try {\n              navigate(url);\n            } catch (e) {\n              console.error(e);\n            }\n          }\n        }\n      } else if (changeType === \"visual\") {\n        const undo = this._options.applyDomChangesCallback\n          ? this._options.applyDomChangesCallback(result.value)\n          : this._applyDOMChanges(result.value);\n        if (undo) {\n          this._activeAutoExperiments.set(experiment, {\n            undo,\n            valueHash,\n          });\n        }\n      }\n    }\n\n    return result;\n  }\n\n  private _undoActiveAutoExperiment(exp: AutoExperiment) {\n    const data = this._activeAutoExperiments.get(exp);\n    if (data) {\n      data.undo();\n      this._activeAutoExperiments.delete(exp);\n    }\n  }\n\n  private _updateAllAutoExperiments(forceRerun?: boolean) {\n    if (!this._autoExperimentsAllowed) return;\n\n    const experiments = this._options.experiments || [];\n\n    // Stop any experiments that are no longer defined\n    const keys = new Set(experiments);\n    this._activeAutoExperiments.forEach((v, k) => {\n      if (!keys.has(k)) {\n        v.undo();\n        this._activeAutoExperiments.delete(k);\n      }\n    });\n\n    // Re-run all new/updated experiments\n    for (const exp of experiments) {\n      const result = this._runAutoExperiment(exp, forceRerun);\n\n      // Once you're in a redirect experiment, break out of the loop and don't run any further experiments\n      if (\n        result?.inExperiment &&\n        getAutoExperimentChangeType(exp) === \"redirect\"\n      ) {\n        break;\n      }\n    }\n  }\n\n  private _fireSubscriptions<T>(experiment: Experiment<T>, result: Result<T>) {\n    const key = experiment.key;\n\n    // If assigned variation has changed, fire subscriptions\n    const prev = this._assigned.get(key);\n    // TODO: what if the experiment definition has changed?\n    if (\n      !prev ||\n      prev.result.inExperiment !== result.inExperiment ||\n      prev.result.variationId !== result.variationId\n    ) {\n      this._assigned.set(key, { experiment, result });\n      this._subscriptions.forEach((cb) => {\n        try {\n          cb(experiment, result);\n        } catch (e) {\n          console.error(e);\n        }\n      });\n    }\n  }\n\n  private _recordChangedId(id: string) {\n    this._completedChangeIds.add(id);\n  }\n\n  public isOn<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this.evalFeature(key).on;\n  }\n\n  public isOff<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this.evalFeature(key).off;\n  }\n\n  public getFeatureValue<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(key: K, defaultValue: V): WidenPrimitives<V> {\n    const value = this.evalFeature<WidenPrimitives<V>, K>(key).value;\n    return value === null ? (defaultValue as WidenPrimitives<V>) : value;\n  }\n\n  /**\n   * @deprecated Use {@link evalFeature}\n   * @param id\n   */\n  // eslint-disable-next-line\n  public feature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K): FeatureResult<V | null> {\n    return this.evalFeature(id);\n  }\n\n  public evalFeature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K): FeatureResult<V | null> {\n    return _evalFeature(id, this._getEvalContext());\n  }\n\n  log(msg: string, ctx: Record<string, unknown>) {\n    if (!this.debug) return;\n    if (this._options.log) this._options.log(msg, ctx);\n    else console.log(msg, ctx);\n  }\n\n  public getDeferredTrackingCalls(): TrackingData[] {\n    return Array.from(this._deferredTrackingCalls.values());\n  }\n\n  public setDeferredTrackingCalls(calls: TrackingData[]) {\n    this._deferredTrackingCalls = new Map(\n      calls\n        .filter((c) => c && c.experiment && c.result)\n        .map((c) => {\n          return [getExperimentDedupeKey(c.experiment, c.result), c];\n        })\n    );\n  }\n\n  public async fireDeferredTrackingCalls() {\n    if (!this._options.trackingCallback) return;\n\n    const promises: ReturnType<TrackingCallback>[] = [];\n    this._deferredTrackingCalls.forEach((call: TrackingData) => {\n      if (!call || !call.experiment || !call.result) {\n        console.error(\"Invalid deferred tracking call\", { call: call });\n      } else {\n        promises.push(\n          (this._options.trackingCallback as TrackingCallback)(\n            call.experiment,\n            call.result\n          )\n        );\n      }\n    });\n    this._deferredTrackingCalls.clear();\n    await Promise.all(promises);\n  }\n\n  public setTrackingCallback(callback: TrackingCallback) {\n    this._options.trackingCallback = callback;\n    this.fireDeferredTrackingCalls();\n  }\n\n  public setEventLogger(logger: EventLogger) {\n    this._options.eventLogger = logger;\n  }\n\n  public async logEvent(\n    eventName: string,\n    properties?: Record<string, unknown>\n  ) {\n    if (this._destroyed) {\n      console.error(\"Cannot log event to destroyed GrowthBook instance\");\n      return;\n    }\n    if (this._options.enableDevMode) {\n      this.logs.push({\n        eventName,\n        properties,\n        timestamp: Date.now().toString(),\n        logType: \"event\",\n      });\n    }\n    if (this._options.eventLogger) {\n      try {\n        await this._options.eventLogger(\n          eventName,\n          properties || {},\n          this._getUserContext()\n        );\n      } catch (e) {\n        console.error(e);\n      }\n    } else {\n      console.error(\"No event logger configured\");\n    }\n  }\n\n  private _saveDeferredTrack(data: TrackingData) {\n    this._deferredTrackingCalls.set(\n      getExperimentDedupeKey(data.experiment, data.result),\n      data\n    );\n  }\n\n  private _getContextUrl() {\n    return this._options.url || (isBrowser ? window.location.href : \"\");\n  }\n\n  private _isAutoExperimentBlockedByContext(\n    experiment: AutoExperiment\n  ): boolean {\n    const changeType = getAutoExperimentChangeType(experiment);\n    if (changeType === \"visual\") {\n      if (this._options.disableVisualExperiments) return true;\n\n      if (this._options.disableJsInjection) {\n        if (experiment.variations.some((v) => v.js)) {\n          return true;\n        }\n      }\n    } else if (changeType === \"redirect\") {\n      if (this._options.disableUrlRedirectExperiments) return true;\n\n      // Validate URLs\n      try {\n        const current = new URL(this._getContextUrl());\n        for (const v of experiment.variations) {\n          if (!v || !v.urlRedirect) continue;\n          const url = new URL(v.urlRedirect);\n\n          // If we're blocking cross origin redirects, block if the protocol or host is different\n          if (this._options.disableCrossOriginUrlRedirectExperiments) {\n            if (url.protocol !== current.protocol) return true;\n            if (url.host !== current.host) return true;\n          }\n        }\n      } catch (e) {\n        // Problem parsing one of the URLs\n        this.log(\"Error parsing current or redirect URL\", {\n          id: experiment.key,\n          error: e,\n        });\n        return true;\n      }\n    } else {\n      // Block any unknown changeTypes\n      return true;\n    }\n\n    if (\n      experiment.changeId &&\n      (this._options.blockedChangeIds || []).includes(experiment.changeId)\n    ) {\n      return true;\n    }\n\n    return false;\n  }\n\n  public getRedirectUrl(): string {\n    return this._redirectedUrl;\n  }\n\n  private _getNavigateFunction(): {\n    navigate: null | ((url: string) => void | Promise<void>);\n    delay: number;\n  } {\n    if (this._options.navigate) {\n      return {\n        navigate: this._options.navigate,\n        delay: 0,\n      };\n    } else if (isBrowser) {\n      return {\n        navigate: (url: string) => {\n          window.location.replace(url);\n        },\n        delay: 100,\n      };\n    }\n    return {\n      navigate: null,\n      delay: 0,\n    };\n  }\n\n  private _applyDOMChanges(changes: AutoExperimentVariation) {\n    if (!isBrowser) return;\n    const undo: (() => void)[] = [];\n    if (changes.css) {\n      const s = document.createElement(\"style\");\n      s.innerHTML = changes.css;\n      document.head.appendChild(s);\n      undo.push(() => s.remove());\n    }\n    if (changes.js) {\n      const script = document.createElement(\"script\");\n      script.innerHTML = changes.js;\n      if (this._options.jsInjectionNonce) {\n        script.nonce = this._options.jsInjectionNonce;\n      }\n      document.head.appendChild(script);\n      undo.push(() => script.remove());\n    }\n    if (changes.domMutations) {\n      changes.domMutations.forEach((mutation) => {\n        undo.push(mutate.declarative(mutation as DeclarativeMutation).revert);\n      });\n    }\n    return () => {\n      undo.forEach((fn) => fn());\n    };\n  }\n\n  public async refreshStickyBuckets(data?: FeatureApiResponse) {\n    if (this._options.stickyBucketService) {\n      const ctx = this._getEvalContext();\n      const docs = await getAllStickyBucketAssignmentDocs(\n        ctx,\n        this._options.stickyBucketService,\n        data\n      );\n      this._options.stickyBucketAssignmentDocs = docs;\n    }\n  }\n\n  public generateStickyBucketAssignmentDocsSync(\n    stickyBucketService: StickyBucketServiceSync,\n    payload: FeatureApiResponse\n  ) {\n    if (!(\"getAllAssignmentsSync\" in stickyBucketService)) {\n      console.error(\n        \"generating StickyBucketAssignmentDocs docs requires StickyBucketServiceSync\"\n      );\n      return;\n    }\n    const ctx = this._getEvalContext();\n    const attributes = getStickyBucketAttributes(ctx, payload);\n    return stickyBucketService.getAllAssignmentsSync(attributes);\n  }\n\n  public inDevMode(): boolean {\n    return !!this._options.enableDevMode;\n  }\n}\n\nexport async function prefetchPayload(options: PrefetchOptions) {\n  // Create a temporary instance, just to fetch the payload\n  const instance = new GrowthBook(options);\n\n  await refreshFeatures({\n    instance,\n    skipCache: options.skipCache,\n    allowStale: false,\n    backgroundSync: options.streaming,\n  });\n\n  instance.destroy();\n}\n","import {\n  LocalStorageCompat,\n  StickyAssignmentsDocument,\n  StickyAttributeKey,\n} from \"./types/growthbook\";\nimport { toString } from \"./util\";\nimport { getStickyBucketAttributeKey } from \"./core\";\n\nexport interface CookieAttributes {\n  expires?: number | Date | undefined;\n  path?: string | undefined;\n  domain?: string | undefined;\n  secure?: boolean | undefined;\n  sameSite?: \"strict\" | \"Strict\" | \"lax\" | \"Lax\" | \"none\" | \"None\" | undefined;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [property: string]: any;\n}\nexport interface JsCookiesCompat<T = string> {\n  set(\n    name: string,\n    value: string | T,\n    options?: CookieAttributes\n  ): string | undefined;\n  get(name: string): string | T | undefined;\n  get(): { [key: string]: string };\n  remove(name: string, options?: CookieAttributes): void;\n}\n\nexport interface IORedisCompat {\n  mget(...keys: string[]): Promise<string[]>;\n  set(key: string, value: string): Promise<string>;\n}\n\nexport interface RequestCompat {\n  cookies: Record<string, string>;\n  [key: string]: unknown;\n}\nexport interface ResponseCompat {\n  cookie(\n    name: string,\n    value: string,\n    options?: CookieAttributes\n  ): ResponseCompat;\n  [key: string]: unknown;\n}\n\n/**\n * Responsible for reading and writing documents which describe sticky bucket assignments.\n */\nexport abstract class StickyBucketService {\n  protected prefix: string;\n\n  constructor(opts?: { prefix?: string }) {\n    opts = opts || {};\n    this.prefix = opts.prefix || \"\";\n  }\n\n  abstract getAssignments(\n    attributeName: string,\n    attributeValue: string\n  ): Promise<StickyAssignmentsDocument | null>;\n\n  abstract saveAssignments(doc: StickyAssignmentsDocument): Promise<unknown>;\n\n  /**\n   * The SDK calls getAllAssignments to populate sticky buckets. This in turn will\n   * typically loop through individual getAssignments calls. However, some StickyBucketService\n   * instances (i.e. Redis) will instead perform a multi-query inside getAllAssignments instead.\n   */\n  async getAllAssignments(\n    attributes: Record<string, string>\n  ): Promise<Record<StickyAttributeKey, StickyAssignmentsDocument>> {\n    const docs: Record<string, StickyAssignmentsDocument> = {};\n    (\n      await Promise.all(\n        Object.entries(attributes).map(([attributeName, attributeValue]) =>\n          this.getAssignments(attributeName, attributeValue)\n        )\n      )\n    ).forEach((doc) => {\n      if (doc) {\n        const key = getStickyBucketAttributeKey(\n          doc.attributeName,\n          doc.attributeValue\n        );\n        docs[key] = doc;\n      }\n    });\n    return docs;\n  }\n\n  getKey(attributeName: string, attributeValue: string): string {\n    return `${this.prefix}${attributeName}||${attributeValue}`;\n  }\n}\n\nexport abstract class StickyBucketServiceSync extends StickyBucketService {\n  abstract getAssignmentsSync(\n    attributeName: string,\n    attributeValue: string\n  ): StickyAssignmentsDocument | null;\n\n  abstract saveAssignmentsSync(doc: StickyAssignmentsDocument): void;\n\n  async getAssignments(attributeName: string, attributeValue: string) {\n    return this.getAssignmentsSync(attributeName, attributeValue);\n  }\n\n  async saveAssignments(doc: StickyAssignmentsDocument) {\n    this.saveAssignmentsSync(doc);\n  }\n\n  getAllAssignmentsSync(\n    attributes: Record<string, string>\n  ): Record<StickyAttributeKey, StickyAssignmentsDocument> {\n    const docs: Record<string, StickyAssignmentsDocument> = {};\n    Object.entries(attributes)\n      .map(([attributeName, attributeValue]) =>\n        this.getAssignmentsSync(attributeName, attributeValue)\n      )\n      .forEach((doc) => {\n        if (doc) {\n          const key = getStickyBucketAttributeKey(\n            doc.attributeName,\n            doc.attributeValue\n          );\n          docs[key] = doc;\n        }\n      });\n    return docs;\n  }\n}\n\nexport class LocalStorageStickyBucketService extends StickyBucketService {\n  private localStorage: LocalStorageCompat | undefined;\n  constructor(opts?: { prefix?: string; localStorage?: LocalStorageCompat }) {\n    opts = opts || {};\n    super();\n    this.prefix = opts.prefix || \"gbStickyBuckets__\";\n    try {\n      this.localStorage = opts.localStorage || globalThis.localStorage;\n    } catch (e) {\n      // Ignore localStorage errors\n    }\n  }\n  async getAssignments(attributeName: string, attributeValue: string) {\n    const key = this.getKey(attributeName, attributeValue);\n    let doc: StickyAssignmentsDocument | null = null;\n    if (!this.localStorage) return doc;\n    try {\n      const raw = (await this.localStorage.getItem(key)) || \"{}\";\n      const data = JSON.parse(raw);\n      if (data.attributeName && data.attributeValue && data.assignments) {\n        doc = data;\n      }\n    } catch (e) {\n      // Ignore localStorage errors\n    }\n    return doc;\n  }\n  async saveAssignments(doc: StickyAssignmentsDocument) {\n    const key = this.getKey(doc.attributeName, doc.attributeValue);\n    if (!this.localStorage) return;\n    try {\n      await this.localStorage.setItem(key, JSON.stringify(doc));\n    } catch (e) {\n      // Ignore localStorage errors\n    }\n  }\n}\n\nexport class ExpressCookieStickyBucketService extends StickyBucketServiceSync {\n  /**\n   * Intended to be used with cookieParser() middleware from npm: 'cookie-parser'.\n   * Assumes:\n   *  - reading a cookie is automatically decoded via decodeURIComponent() or similar\n   *  - writing a cookie name & value must be manually encoded via encodeURIComponent() or similar\n   *  - all cookie bodies are JSON encoded strings and are manually encoded/decoded\n   */\n  private req: RequestCompat;\n  private res: ResponseCompat;\n  private cookieAttributes: CookieAttributes;\n  constructor({\n    prefix = \"gbStickyBuckets__\",\n    req,\n    res,\n    cookieAttributes = { maxAge: 180 * 24 * 3600 * 1000 }, // 180 days\n  }: {\n    prefix?: string;\n    req: RequestCompat;\n    res: ResponseCompat;\n    cookieAttributes?: CookieAttributes;\n  }) {\n    super();\n    this.prefix = prefix;\n    this.req = req;\n    this.res = res;\n    this.cookieAttributes = cookieAttributes;\n  }\n  getAssignmentsSync(attributeName: string, attributeValue: string) {\n    const key = this.getKey(attributeName, attributeValue);\n    let doc: StickyAssignmentsDocument | null = null;\n    if (!this.req) return doc;\n    try {\n      const raw = this.req.cookies[key] || \"{}\";\n      const data = JSON.parse(raw);\n      if (data.attributeName && data.attributeValue && data.assignments) {\n        doc = data;\n      }\n    } catch (e) {\n      // Ignore cookie errors\n    }\n    return doc;\n  }\n  saveAssignmentsSync(doc: StickyAssignmentsDocument) {\n    const key = this.getKey(doc.attributeName, doc.attributeValue);\n    if (!this.res) return;\n    const str = JSON.stringify(doc);\n    this.res.cookie(\n      encodeURIComponent(key),\n      encodeURIComponent(str),\n      this.cookieAttributes\n    );\n  }\n}\n\nexport class BrowserCookieStickyBucketService extends StickyBucketServiceSync {\n  /**\n   * Intended to be used with npm: 'js-cookie'.\n   * Assumes:\n   *  - reading a cookie is automatically decoded via decodeURIComponent() or similar\n   *  - writing a cookie name & value is automatically encoded via encodeURIComponent() or similar\n   *  - all cookie bodies are JSON encoded strings and are manually encoded/decoded\n   */\n  private jsCookie: JsCookiesCompat;\n  private cookieAttributes: CookieAttributes;\n  constructor({\n    prefix = \"gbStickyBuckets__\",\n    jsCookie,\n    cookieAttributes = { expires: 180 }, // 180 days\n  }: {\n    prefix?: string;\n    jsCookie: JsCookiesCompat;\n    cookieAttributes?: CookieAttributes;\n  }) {\n    super();\n    this.prefix = prefix;\n    this.jsCookie = jsCookie;\n    this.cookieAttributes = cookieAttributes;\n  }\n  getAssignmentsSync(attributeName: string, attributeValue: string) {\n    const key = this.getKey(attributeName, attributeValue);\n    let doc: StickyAssignmentsDocument | null = null;\n    if (!this.jsCookie) return doc;\n    try {\n      const raw = this.jsCookie.get(key);\n      const data = JSON.parse(raw || \"{}\");\n      if (data.attributeName && data.attributeValue && data.assignments) {\n        doc = data;\n      }\n    } catch (e) {\n      // Ignore cookie errors\n    }\n    return doc;\n  }\n  async saveAssignmentsSync(doc: StickyAssignmentsDocument) {\n    const key = this.getKey(doc.attributeName, doc.attributeValue);\n    if (!this.jsCookie) return;\n    const str = JSON.stringify(doc);\n    this.jsCookie.set(key, str, this.cookieAttributes);\n  }\n}\n\nexport class RedisStickyBucketService extends StickyBucketService {\n  /** Intended to be used with npm: 'ioredis'. **/\n  private redis: IORedisCompat | undefined;\n  constructor({ redis }: { redis: IORedisCompat }) {\n    super();\n    this.redis = redis;\n  }\n  async getAllAssignments(\n    attributes: Record<string, string>\n  ): Promise<Record<StickyAttributeKey, StickyAssignmentsDocument>> {\n    const docs: Record<StickyAttributeKey, StickyAssignmentsDocument> = {};\n    const keys = Object.entries(\n      attributes\n    ).map(([attributeName, attributeValue]) =>\n      getStickyBucketAttributeKey(attributeName, attributeValue)\n    );\n    if (!this.redis) return docs;\n    await this.redis.mget(...keys).then((values) => {\n      values.forEach((raw) => {\n        try {\n          const data = JSON.parse(raw || \"{}\");\n          if (\n            data.attributeName &&\n            \"attributeValue\" in data &&\n            data.assignments\n          ) {\n            const key = getStickyBucketAttributeKey(\n              data.attributeName,\n              toString(data.attributeValue)\n            );\n            docs[key] = data;\n          }\n        } catch (e) {\n          // ignore redis doc parse errors\n        }\n      });\n    });\n    return docs;\n  }\n  async getAssignments(_attributeName: string, _attributeValue: string) {\n    // not implemented\n    return null;\n  }\n  async saveAssignments(doc: StickyAssignmentsDocument) {\n    const key = this.getKey(doc.attributeName, doc.attributeValue);\n    if (!this.redis) return;\n    await this.redis.set(key, JSON.stringify(doc));\n  }\n}\n","import type { GrowthBook } from \"../GrowthBook\";\nimport type {\n  UserScopedGrowthBook,\n  GrowthBookClient,\n} from \"../GrowthBookClient\";\n\nexport type AutoAttributeSettings = {\n  uuidCookieName?: string;\n  uuidKey?: string;\n  uuid?: string;\n  uuidAutoPersist?: boolean;\n};\n\nfunction getBrowserDevice(ua: string): { browser: string; deviceType: string } {\n  const browser = ua.match(/Edg/)\n    ? \"edge\"\n    : ua.match(/Chrome/)\n    ? \"chrome\"\n    : ua.match(/Firefox/)\n    ? \"firefox\"\n    : ua.match(/Safari/)\n    ? \"safari\"\n    : \"unknown\";\n\n  const deviceType = ua.match(/Mobi/) ? \"mobile\" : \"desktop\";\n\n  return { browser, deviceType };\n}\n\nfunction getURLAttributes(url: URL | Location | undefined) {\n  if (!url) return {};\n  return {\n    url: url.href,\n    path: url.pathname,\n    host: url.host,\n    query: url.search,\n  };\n}\n\nexport function autoAttributesPlugin(settings: AutoAttributeSettings = {}) {\n  // Browser only\n  if (typeof window === \"undefined\") {\n    throw new Error(\"autoAttributesPlugin only works in the browser\");\n  }\n\n  const COOKIE_NAME = settings.uuidCookieName || \"gbuuid\";\n  const uuidKey = settings.uuidKey || \"id\";\n  let uuid = settings.uuid || \"\";\n  function persistUUID() {\n    setCookie(COOKIE_NAME, uuid);\n  }\n  function getUUID() {\n    // Already stored in memory, return\n    if (uuid) return uuid;\n\n    // If cookie is already set, return\n    uuid = getCookie(COOKIE_NAME);\n    if (uuid) return uuid;\n\n    // Generate a new UUID\n    uuid = genUUID(window.crypto);\n    return uuid;\n  }\n\n  // Listen for a custom event to persist the UUID cookie\n  document.addEventListener(\"growthbookpersist\", () => {\n    persistUUID();\n  });\n\n  function getAutoAttributes(settings: AutoAttributeSettings) {\n    const ua = navigator.userAgent;\n\n    const _uuid = getUUID();\n\n    // If a uuid is provided, default persist to false, otherwise default to true\n    if (settings.uuidAutoPersist ?? !settings.uuid) {\n      persistUUID();\n    }\n\n    const url = location;\n\n    return {\n      ...getDataLayerVariables(),\n      [uuidKey]: _uuid,\n      ...getURLAttributes(url),\n      pageTitle: document.title,\n      ...getBrowserDevice(ua),\n      ...getUtmAttributes(url),\n    };\n  }\n\n  return (gb: GrowthBook | UserScopedGrowthBook | GrowthBookClient) => {\n    // Only works for instances with user attributes\n    if (\"createScopedInstance\" in gb) {\n      return;\n    }\n\n    // Set initial attributes\n    const attributes = getAutoAttributes(settings);\n    attributes.url && gb.setURL(attributes.url);\n    gb.updateAttributes(attributes);\n\n    // Poll for URL changes and update GrowthBook\n    let currentUrl = attributes.url;\n    const intervalTimer = setInterval(() => {\n      if (location.href !== currentUrl) {\n        currentUrl = location.href;\n        gb.setURL(currentUrl);\n        gb.updateAttributes(getAutoAttributes(settings));\n      }\n    }, 500);\n\n    // Listen for a custom event to update URL and attributes\n    const refreshListener = () => {\n      if (location.href !== currentUrl) {\n        currentUrl = location.href;\n        gb.setURL(currentUrl);\n      }\n      gb.updateAttributes(getAutoAttributes(settings));\n    };\n    document.addEventListener(\"growthbookrefresh\", refreshListener);\n\n    if (\"onDestroy\" in gb) {\n      gb.onDestroy(() => {\n        clearInterval(intervalTimer);\n        document.removeEventListener(\"growthbookrefresh\", refreshListener);\n      });\n    }\n  };\n}\n\nfunction setCookie(name: string, value: string) {\n  const d = new Date();\n  const COOKIE_DAYS = 400; // 400 days is the max cookie duration for chrome\n  d.setTime(d.getTime() + 24 * 60 * 60 * 1000 * COOKIE_DAYS);\n  document.cookie = name + \"=\" + value + \";path=/;expires=\" + d.toUTCString();\n}\n\nfunction getCookie(name: string): string {\n  const value = \"; \" + document.cookie;\n  const parts = value.split(`; ${name}=`);\n  return parts.length === 2 ? parts[1].split(\";\")[0] : \"\";\n}\n\n// Use the browsers crypto.randomUUID if set to generate a UUID\nfunction genUUID(crypto?: Crypto) {\n  if (crypto && crypto.randomUUID) return crypto.randomUUID();\n  return (\"\" + 1e7 + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (c) => {\n    const n =\n      crypto && crypto.getRandomValues\n        ? crypto.getRandomValues(new Uint8Array(1))[0]\n        : Math.floor(Math.random() * 256);\n    return (\n      ((c as unknown) as number) ^\n      (n & (15 >> (((c as unknown) as number) / 4)))\n    ).toString(16);\n  });\n}\n\nfunction getUtmAttributes(url: URL | Location | undefined) {\n  // Store utm- params in sessionStorage for future page loads\n  let utms: Record<string, string> = {};\n  try {\n    const existing = sessionStorage.getItem(\"utm_params\");\n    if (existing) {\n      utms = JSON.parse(existing);\n    }\n  } catch (e) {\n    // Do nothing if sessionStorage is disabled (e.g. incognito window)\n  }\n\n  // Add utm params from querystring\n  if (url && url.search) {\n    const params = new URLSearchParams(url.search);\n    let hasChanges = false;\n    [\"source\", \"medium\", \"campaign\", \"term\", \"content\"].forEach((k) => {\n      // Querystring is in snake_case\n      const param = `utm_${k}`;\n      // Attribute keys are camelCase\n      const attr = `utm` + k[0].toUpperCase() + k.slice(1);\n\n      if (params.has(param)) {\n        utms[attr] = params.get(param) || \"\";\n        hasChanges = true;\n      }\n    });\n\n    // Write back to sessionStorage\n    if (hasChanges) {\n      try {\n        sessionStorage.setItem(\"utm_params\", JSON.stringify(utms));\n      } catch (e) {\n        // Do nothing if sessionStorage is disabled (e.g. incognito window)\n      }\n    }\n  }\n\n  return utms;\n}\n\nfunction getDataLayerVariables() {\n  if (\n    typeof window === \"undefined\" ||\n    !window.dataLayer ||\n    !window.dataLayer.forEach\n  ) {\n    return {};\n  }\n\n  const obj: Record<string, unknown> = {};\n  window.dataLayer.forEach((item: unknown) => {\n    // Skip empty and non-object entries\n    if (!item || typeof item !== \"object\" || \"length\" in item) return;\n\n    // Skip events\n    if (\"event\" in item) return;\n\n    Object.keys(item).forEach((k) => {\n      // Filter out known properties that aren't useful\n      if (typeof k !== \"string\" || k.match(/^(gtm)/)) return;\n\n      const val = (item as Record<string, unknown>)[k];\n\n      // Only add primitive variable values\n      const valueType = typeof val;\n      if ([\"string\", \"number\", \"boolean\"].includes(valueType)) {\n        obj[k] = val;\n      }\n    });\n  });\n  return obj;\n}\n","import { loadSDKVersion } from \"../util\";\nimport type { Attributes, EventProperties } from \"../types/growthbook\";\nimport type { GrowthBook } from \"../GrowthBook\";\nimport type {\n  GrowthBookClient,\n  UserScopedGrowthBook,\n} from \"../GrowthBookClient\";\nimport { EVENT_EXPERIMENT_VIEWED, EVENT_FEATURE_EVALUATED } from \"../core\";\n\nconst SDK_VERSION = loadSDKVersion();\n\ntype GlobalTrackedEvent = {\n  eventName: string;\n  properties: Record<string, unknown>;\n};\ndeclare global {\n  interface Window {\n    gbEvents?:\n      | (GlobalTrackedEvent | string)[]\n      | {\n          push: (event: GlobalTrackedEvent | string) => void;\n        };\n  }\n}\n\ntype EventPayload = {\n  event_name: string;\n  properties_json: Record<string, unknown>;\n  sdk_language: string;\n  sdk_version: string;\n  url: string;\n  context_json: Record<string, unknown>;\n  user_id: string | null;\n  device_id: string | null;\n  page_id: string | null;\n  session_id: string | null;\n  page_title?: string;\n  utm_source?: string;\n  utm_medium?: string;\n  utm_campaign?: string;\n  utm_term?: string;\n  utm_content?: string;\n};\n\nfunction parseString(value: unknown): null | string {\n  return typeof value === \"string\" ? value : null;\n}\n\nfunction parseAttributes(\n  attributes: Attributes\n): {\n  nested: Attributes;\n  topLevel: {\n    user_id: string | null;\n    device_id: string | null;\n    page_id: string | null;\n    session_id: string | null;\n    page_title?: string;\n    utm_source?: string;\n    utm_medium?: string;\n    utm_campaign?: string;\n    utm_term?: string;\n    utm_content?: string;\n  };\n} {\n  const {\n    user_id,\n    device_id,\n    anonymous_id,\n    id,\n    page_id,\n    session_id,\n    utmCampaign,\n    utmContent,\n    utmMedium,\n    utmSource,\n    utmTerm,\n    pageTitle,\n    ...nested\n  } = attributes;\n\n  return {\n    nested,\n    topLevel: {\n      user_id: parseString(user_id),\n      device_id: parseString(device_id || anonymous_id || id),\n      page_id: parseString(page_id),\n      session_id: parseString(session_id),\n      utm_campaign: parseString(utmCampaign) || undefined,\n      utm_content: parseString(utmContent) || undefined,\n      utm_medium: parseString(utmMedium) || undefined,\n      utm_source: parseString(utmSource) || undefined,\n      utm_term: parseString(utmTerm) || undefined,\n      page_title: parseString(pageTitle) || undefined,\n    },\n  };\n}\n\ntype EventData = {\n  eventName: string;\n  properties: EventProperties;\n  attributes: Attributes;\n  url: string;\n};\n\nfunction getEventPayload({\n  eventName,\n  properties,\n  attributes,\n  url,\n}: EventData): EventPayload {\n  const { nested, topLevel } = parseAttributes(attributes || {});\n\n  return {\n    event_name: eventName,\n    properties_json: properties || {},\n    ...topLevel,\n    sdk_language: \"js\",\n    sdk_version: SDK_VERSION,\n    url: url,\n    context_json: nested,\n  };\n}\n\nasync function track({\n  clientKey,\n  ingestorHost,\n  events,\n}: {\n  events: EventPayload[];\n  clientKey: string;\n  ingestorHost?: string;\n}) {\n  if (!events.length) return;\n\n  const endpoint = `${\n    ingestorHost || \"https://us1.gb-ingest.com\"\n  }/track?client_key=${clientKey}`;\n  const body = JSON.stringify(events);\n\n  try {\n    await fetch(endpoint, {\n      method: \"POST\",\n      body,\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"text/plain\",\n      },\n      credentials: \"omit\",\n    });\n  } catch (e) {\n    console.error(\"Failed to track event\", e);\n  }\n}\n\nexport function growthbookTrackingPlugin({\n  queueFlushInterval = 100,\n  ingestorHost,\n  enable = true,\n  debug,\n  dedupeCacheSize = 1000,\n  dedupeKeyAttributes = [],\n  eventFilter,\n}: {\n  // TODO: add option to allow filtering out certain attributes that contain PII\n  queueFlushInterval?: number;\n  ingestorHost?: string;\n  enable?: boolean;\n  debug?: boolean;\n  dedupeCacheSize?: number;\n  dedupeKeyAttributes?: string[];\n  eventFilter?: (event: EventData) => boolean;\n} = {}) {\n  return (gb: GrowthBook | UserScopedGrowthBook | GrowthBookClient) => {\n    const clientKey = gb.getClientKey();\n    if (!clientKey) {\n      throw new Error(\"clientKey must be specified to use event logging\");\n    }\n\n    // LRU cache for events to avoid duplicates\n    const eventCache = new Set<string>();\n\n    if (\"setEventLogger\" in gb) {\n      let _q: EventPayload[] = [];\n      let timer: NodeJS.Timeout | null = null;\n      const flush = async () => {\n        const events = _q;\n        _q = [];\n        timer && clearTimeout(timer);\n        timer = null;\n        events.length && (await track({ clientKey, events, ingestorHost }));\n      };\n\n      let promise: Promise<void> | null = null;\n      gb.setEventLogger(async (eventName, properties, userContext) => {\n        const data: EventData = {\n          eventName,\n          properties,\n          attributes: userContext.attributes || {},\n          url: userContext.url || \"\",\n        };\n\n        // Skip logging if the event is being filtered\n        if (eventFilter && !eventFilter(data)) {\n          return;\n        }\n\n        // De-dupe Feature Evaluated and Experiment Viewed events\n        if (\n          eventName === EVENT_FEATURE_EVALUATED ||\n          eventName === EVENT_EXPERIMENT_VIEWED\n        ) {\n          // Build the key for de-duping\n          const dedupeKeyData: Record<string, unknown> = {\n            eventName,\n            properties,\n          };\n          for (const key of dedupeKeyAttributes) {\n            dedupeKeyData[\"attr:\" + key] = data.attributes[key];\n          }\n\n          const k = JSON.stringify(dedupeKeyData);\n          // Duplicate event fired recently, move to end of LRU cache and skip\n          if (eventCache.has(k)) {\n            eventCache.delete(k);\n            eventCache.add(k);\n            return;\n          }\n          eventCache.add(k);\n\n          // If the cache is too big, remove the oldest item\n          if (eventCache.size > dedupeCacheSize) {\n            const oldest = eventCache.values().next().value;\n            oldest && eventCache.delete(oldest);\n          }\n        }\n\n        const payload = getEventPayload(data);\n\n        debug &&\n          console.log(\n            \"Logging event to GrowthBook\",\n            JSON.parse(JSON.stringify(payload))\n          );\n        if (!enable) return;\n\n        _q.push(payload);\n\n        // Only one in-progress promise at a time\n        if (!promise) {\n          promise = new Promise((resolve, reject) => {\n            // Flush the queue after a delay\n            timer = setTimeout(() => {\n              flush().then(resolve).catch(reject);\n              promise = null;\n            }, queueFlushInterval);\n          });\n        }\n        await promise;\n      });\n\n      // Flush the queue on page unload\n      if (typeof document !== \"undefined\" && document.visibilityState) {\n        document.addEventListener(\"visibilitychange\", () => {\n          if (document.visibilityState === \"hidden\") {\n            flush().catch(console.error);\n          }\n        });\n      }\n\n      // Flush the queue when the growthbook instance is destroyed\n      \"onDestroy\" in gb &&\n        gb.onDestroy(() => {\n          flush().catch(console.error);\n        });\n    }\n\n    // Listen on window.gbEvents.push if in a browser\n    // This makes it easier to integrate with Segment, GTM, etc.\n    if (typeof window !== \"undefined\" && !(\"createScopedInstance\" in gb)) {\n      const prevEvents = Array.isArray(window.gbEvents) ? window.gbEvents : [];\n      window.gbEvents = {\n        push: (event: GlobalTrackedEvent | string) => {\n          if (\"isDestroyed\" in gb && gb.isDestroyed()) {\n            // If trying to log and the instance has been destroyed, switch back to just an array\n            // This will let the next GrowthBook instance pick it up\n            window.gbEvents = [event];\n            return;\n          }\n\n          if (typeof event === \"string\") {\n            gb.logEvent(event);\n          } else if (event) {\n            gb.logEvent(event.eventName, event.properties);\n          }\n        },\n      };\n      for (const event of prevEvents) {\n        window.gbEvents.push(event);\n      }\n    }\n  };\n}\n","import type { TrackingCallback } from \"../types/growthbook\";\nimport type { GrowthBook } from \"../GrowthBook\";\nimport type {\n  GrowthBookClient,\n  UserScopedGrowthBook,\n} from \"../GrowthBookClient\";\n\nexport type Trackers = \"gtag\" | \"gtm\" | \"segment\";\n\nexport function thirdPartyTrackingPlugin({\n  additionalCallback,\n  trackers = [\"gtag\", \"gtm\", \"segment\"],\n}: {\n  additionalCallback?: TrackingCallback;\n  trackers?: Trackers[];\n} = {}) {\n  // Browser only\n  if (typeof window === \"undefined\") {\n    throw new Error(\"thirdPartyTrackingPlugin only works in the browser\");\n  }\n\n  return (gb: GrowthBook | UserScopedGrowthBook | GrowthBookClient) => {\n    gb.setTrackingCallback(async (e, r) => {\n      const promises: Promise<unknown>[] = [];\n      const eventParams = { experiment_id: e.key, variation_id: r.key };\n\n      if (additionalCallback) {\n        promises.push(Promise.resolve(additionalCallback(e, r)));\n      }\n\n      // GA4 - gtag\n      if (trackers.includes(\"gtag\") && window.gtag) {\n        let gtagResolve;\n        const gtagPromise = new Promise((resolve) => {\n          gtagResolve = resolve;\n        });\n        promises.push(gtagPromise);\n        window.gtag(\"event\", \"experiment_viewed\", {\n          ...eventParams,\n          event_callback: gtagResolve,\n        });\n      }\n\n      // GTM - dataLayer\n      if (trackers.includes(\"gtm\") && window.dataLayer) {\n        let datalayerResolve;\n        const datalayerPromise = new Promise((resolve) => {\n          datalayerResolve = resolve;\n        });\n        promises.push(datalayerPromise);\n        window.dataLayer.push({\n          event: \"experiment_viewed\",\n          ...eventParams,\n          eventCallback: datalayerResolve,\n        });\n      }\n\n      // Segment - analytics.js\n      if (\n        trackers.includes(\"segment\") &&\n        window.analytics &&\n        window.analytics.track\n      ) {\n        window.analytics.track(\"Experiment Viewed\", eventParams);\n        const segmentPromise = new Promise((resolve) =>\n          window.setTimeout(resolve, 300)\n        );\n        promises.push(segmentPromise);\n      }\n\n      await Promise.all(promises);\n    });\n  };\n}\n","import Cookies from \"js-cookie\";\nimport {\n  CacheSettings,\n  Options as Context,\n  FeatureApiResponse,\n  Plugin,\n  TrackingCallback,\n} from \"./types/growthbook\";\nimport { GrowthBook } from \"./GrowthBook\";\nimport {\n  BrowserCookieStickyBucketService,\n  LocalStorageStickyBucketService,\n  StickyBucketService,\n} from \"./sticky-bucket-service\";\nimport { autoAttributesPlugin } from \"./plugins/auto-attributes\";\nimport { growthbookTrackingPlugin } from \"./plugins/growthbook-tracking\";\nimport {\n  thirdPartyTrackingPlugin,\n  Trackers,\n} from \"./plugins/third-party-tracking\";\n\ntype WindowContext = Context & {\n  uuidCookieName?: string;\n  uuidKey?: string;\n  uuid?: string;\n  persistUuidOnLoad?: boolean;\n  noStreaming?: boolean;\n  useStickyBucketService?: \"cookie\" | \"localStorage\";\n  stickyBucketPrefix?: string;\n  payload?: FeatureApiResponse;\n  cacheSettings?: CacheSettings;\n  antiFlicker?: boolean;\n  antiFlickerTimeout?: number;\n  additionalTrackingCallback?: TrackingCallback;\n};\ndeclare global {\n  interface Window {\n    _growthbook?: GrowthBook;\n    growthbook_queue?:\n      | Array<(gb: GrowthBook) => void>\n      | { push: (cb: (gb: GrowthBook) => void) => void };\n    growthbook_config?: WindowContext;\n    dataLayer?: unknown[];\n    analytics?: {\n      track?: (name: string, props?: Record<string, unknown>) => void;\n    };\n    gtag?: (...args: unknown[]) => void;\n  }\n}\n\n// Ensure dataLayer exists\nwindow.dataLayer = window.dataLayer || [];\n\nconst currentScript = document.currentScript;\nconst dataContext: DOMStringMap = currentScript ? currentScript.dataset : {};\nconst windowContext: WindowContext = window.growthbook_config || {};\n\nlet antiFlickerTimeout: number | undefined;\n\nfunction setAntiFlicker() {\n  window.clearTimeout(antiFlickerTimeout);\n\n  let timeoutMs =\n    windowContext.antiFlickerTimeout ??\n    (dataContext.antiFlickerTimeout\n      ? parseInt(dataContext.antiFlickerTimeout)\n      : null) ??\n    3500;\n  if (!isFinite(timeoutMs)) {\n    timeoutMs = 3500;\n  }\n\n  try {\n    if (!document.getElementById(\"gb-anti-flicker-style\")) {\n      const styleTag = document.createElement(\"style\");\n      styleTag.setAttribute(\"id\", \"gb-anti-flicker-style\");\n      styleTag.innerHTML =\n        \".gb-anti-flicker { opacity: 0 !important; pointer-events: none; }\";\n      document.head.appendChild(styleTag);\n    }\n    document.documentElement.classList.add(\"gb-anti-flicker\");\n\n    // Fallback if GrowthBook fails to load in specified time or 3.5 seconds.\n    antiFlickerTimeout = window.setTimeout(unsetAntiFlicker, timeoutMs);\n  } catch (e) {\n    console.error(e);\n  }\n}\n\nfunction unsetAntiFlicker() {\n  window.clearTimeout(antiFlickerTimeout);\n  try {\n    document.documentElement.classList.remove(\"gb-anti-flicker\");\n  } catch (e) {\n    console.error(e);\n  }\n}\n\nif (windowContext.antiFlicker || dataContext.antiFlicker) {\n  setAntiFlicker();\n}\n\n// Create sticky bucket service\nlet stickyBucketService: StickyBucketService | undefined = undefined;\nif (\n  windowContext.useStickyBucketService === \"cookie\" ||\n  dataContext.useStickyBucketService === \"cookie\"\n) {\n  stickyBucketService = new BrowserCookieStickyBucketService({\n    prefix:\n      windowContext.stickyBucketPrefix ||\n      dataContext.stickyBucketPrefix ||\n      undefined,\n    jsCookie: Cookies,\n  });\n} else if (\n  windowContext.useStickyBucketService === \"localStorage\" ||\n  dataContext.useStickyBucketService === \"localStorage\"\n) {\n  stickyBucketService = new LocalStorageStickyBucketService({\n    prefix:\n      windowContext.stickyBucketPrefix ||\n      dataContext.stickyBucketPrefix ||\n      undefined,\n  });\n}\n\nconst uuid = dataContext.uuid || windowContext.uuid;\nconst plugins: Plugin[] = [\n  autoAttributesPlugin({\n    uuid,\n    uuidCookieName: windowContext.uuidCookieName || dataContext.uuidCookieName,\n    uuidKey: windowContext.uuidKey || dataContext.uuidKey,\n    uuidAutoPersist: !uuid && dataContext.noAutoCookies == null,\n  }),\n];\n\nconst tracking = dataContext.tracking || \"gtag,gtm,segment\";\nif (tracking !== \"none\") {\n  const trackers = tracking\n    .toLowerCase()\n    .split(\",\")\n    .map((t) => t.trim());\n\n  if (trackers.includes(\"growthbook\")) {\n    plugins.push(\n      growthbookTrackingPlugin({\n        ingestorHost: dataContext.eventIngestorHost,\n      })\n    );\n  }\n\n  if (!windowContext.trackingCallback) {\n    plugins.push(\n      thirdPartyTrackingPlugin({\n        additionalCallback: windowContext.additionalTrackingCallback,\n        trackers: trackers as Trackers[],\n      })\n    );\n  }\n}\n\n// Create GrowthBook instance\nconst gb = new GrowthBook({\n  enableDevMode: true,\n  ...dataContext,\n  remoteEval: !!dataContext.remoteEval,\n  ...windowContext,\n  plugins,\n  stickyBucketService,\n});\n\n// Set the renderer to fire a custom DOM event\n// This will let us attach multiple listeners\ngb.setRenderer(() => {\n  document.dispatchEvent(new CustomEvent(\"growthbookdata\"));\n});\n\ngb.init({\n  payload: windowContext.payload,\n  streaming: !(\n    windowContext.noStreaming ||\n    dataContext.noStreaming ||\n    windowContext.backgroundSync === false\n  ),\n  cacheSettings: windowContext.cacheSettings,\n}).then(() => {\n  if (!(windowContext.antiFlicker || dataContext.antiFlicker)) return;\n\n  if (gb.getRedirectUrl()) {\n    setAntiFlicker();\n  } else {\n    unsetAntiFlicker();\n  }\n});\n\nconst fireCallback = (cb: (gb: GrowthBook) => void) => {\n  try {\n    cb && cb(gb);\n  } catch (e) {\n    console.error(\"Uncaught growthbook_queue error\", e);\n  }\n};\n\n// Process any queued callbacks\nif (window.growthbook_queue) {\n  if (Array.isArray(window.growthbook_queue)) {\n    window.growthbook_queue.forEach((cb) => {\n      fireCallback(cb);\n    });\n  }\n}\n// Replace the queue with a function that immediately calls the callback\nwindow.growthbook_queue = {\n  push: (cb: (gb: GrowthBook) => void) => {\n    fireCallback(cb);\n  },\n};\n\n// Store a reference in window to enable more advanced use cases\nexport default gb;\n"],"names":["validAttributeName","nullController","revert","elements","Map","mutations","Set","getObserverInit","attr","childList","subtree","attributes","characterData","attributeFilter","getElementRecord","element","record","get","set","createElementPropertyRecord","el","getCurrentValue","setValue","mutationRunner","currentValue","isDirty","originalValue","virtualValue","_positionTimeout","observer","MutationObserver","setTimeout","parentNode","insertBeforeNode","observe","queueIfNeeded","val","currentVal","runDOMUpdates","htmlMutationRunner","forEach","m","mutate","getTransformedHTML","classMutationRunner","split","filter","Boolean","Array","from","join","attrMutationRunner","_loadDOMNodes","parentSelector","insertBeforeSelector","document","querySelector","positionMutationRunner","selectors","newNodes","getHTMLValue","innerHTML","setHTMLValue","value","getElementHTMLRecord","elementRecord","html","getElementPosition","parentElement","nextElementSibling","setElementPosition","contains","insertBefore","getElementPositionRecord","position","setClassValue","className","removeAttribute","getClassValue","getElementClassRecord","classes","getAttrValue","attrName","getAttribute","setAttrValue","setAttribute","getElementAttributeRecord","deleteElementPropertyRecord","disconnect","transformContainer","createElement","setPropertyValue","length","Object","keys","startMutating","mutation","kind","attribute","push","stopMutating","index","indexOf","splice","refreshElementsSet","size","existingElements","matchingElements","querySelectorAll","selector","has","add","revertMutation","clear","refreshAllElementSets","connectGlobalObserver","documentElement","newMutation","test","mutatedClassnames","classnames","c","declarative","action","polyfills","fetch","globalThis","bind","undefined","SubtleCrypto","crypto","subtle","EventSource","getPolyfills","hashFnv32a","str","hval","l","i","charCodeAt","hash","seed","version","getEqualWeights","n","fill","inRange","range","inNamespace","hashValue","namespace","chooseVariation","ranges","getUrlRegExp","regexString","escaped","replace","RegExp","e","console","error","isURLTargeted","url","targets","hasIncludeRules","isIncluded","match","_evalURLTarget","type","pattern","include","_evalSimpleUrlPart","actual","isPath","regex","_evalSimpleUrlTarget","expected","URL","comps","host","pathname","searchParams","v","k","some","data","parsed","href","substring","origin","getBucketRanges","numVariations","coverage","weights","equal","totalWeight","reduce","w","sum","cumulative","map","start","getQueryStringOverride","id","search","kv","parseInt","base64ToBuf","b","Uint8Array","atob","decrypt","encryptedString","decryptionKey","Error","key","importKey","name","iv","cipherText","plainTextBuffer","TextDecoder","decode","toString","input","JSON","stringify","paddedVersionString","parts","padStart","loadSDKVersion","mergeQueryStrings","oldUrl","newUrl","currUrl","redirectUrl","isObj","x","getAutoExperimentChangeType","exp","urlPatterns","variations","variation","domMutations","promiseTimeout","promise","timeout","Promise","resolve","resolved","timer","finish","clearTimeout","then","catch","cacheSettings","staleTTL","maxAge","cacheKey","backgroundSync","maxEntries","disableIdleStreams","idleStreamInterval","disableCache","helpers","fetchFeaturesCall","clientKey","headers","fetchRemoteEvalCall","payload","options","method","body","eventSourceCall","startIdleListener","idleTimeout","isBrowser","window","onVisibilityChange","visibilityState","onVisible","onHidden","addEventListener","removeEventListener","stopIdleListener","localStorage","subscribedInstances","cacheInitialized","cache","activeFetches","streams","supportsSSE","configureCache","overrides","assign","clearAutoRefresh","refreshFeatures","instance","skipCache","allowStale","fetchFeaturesWithCache","subscribe","getKey","subs","unsubscribe","s","delete","channel","state","disableChannel","enableChannel","updatePersistentCache","setItem","entries","getCacheKey","now","Date","minStaleAt","getTime","initializeCache","existing","staleAt","sse","fetchFeatures","startAutoRefresh","success","source","res","apiHost","getApiInfo","baseKey","isRemoteEval","getAttributes","cacheKeyAttributes","getCacheKeyAttributes","ca","fv","getForcedVariations","getUrl","getItem","parse","isArray","cleanupCache","cleanupFn","entriesWithTimestamps","sort","a","entriesToRemoveCount","Math","min","max","onNewFeatureData","dateUpdated","instances","refreshInstance","setPayload","getPayload","apiRequestHeaders","getApiHosts","getClientKey","remoteEval","fetcher","forcedVariations","forcedFeatures","getForcedFeatures","ok","status","json","forceSSE","streamingHost","streamingHostRequestHeaders","src","cb","event","errors","onSSEError","readyState","delay","pow","random","includes","onopen","onerror","close","destroyChannel","startStreaming","streaming","_regexCache","evalCondition","obj","condition","savedGroups","evalOr","evalAnd","evalConditionValue","getPath","path","current","getRegex","isOperatorObject","op","evalOperatorCondition","getType","t","elemMatch","check","isIn","operator","passed","j","conditions","EVENT_FEATURE_EVALUATED","EVENT_EXPERIMENT_VIEWED","getForcedFeatureValues","ctx","ret","global","forcedFeatureValues","user","safeCall","fn","onExperimentViewed","experiment","result","trackedExperiments","getExperimentDedupeKey","enableDevMode","devLogs","timestamp","logType","calls","trackingCallback","eventLogger","experimentId","variationId","hashAttribute","onFeatureUsage","trackedFeatureUsage","stringifiedValue","featureKey","feature","ruleId","experimentResult","evalFeature","stack","evaluatedFeatures","getFeatureResult","forcedValues","features","rules","rule","parentConditions","parentCondition","parentResult","evalObj","evaled","gate","filters","isFilteredOut","conditionPasses","isIncludedInRollout","saveStickyBucketAssignmentDoc","disableStickyBucketing","fallbackAttribute","hashVersion","tracks","saveDeferredTrack","force","bucketVersion","minBucketVersion","meta","phase","runExperiment","onExperimentEval","inExperiment","passthrough","defaultValue","featureId","getExperimentResult","enabled","mergeOverrides","qsOverride","active","getHashAttribute","assigned","foundStickyBucket","stickyBucketVersionIsBlocked","versionIsBlocked","getStickyBucketVariation","expKey","expBucketVersion","expHashAttribute","expFallbackAttribute","expMinBucketVersion","expMeta","groups","hasGroupOverlap","urlIsValid","qaMode","changed","attrKey","doc","generateStickyBucketAssignmentDoc","getStickyBucketExperimentKey","stickyBucketAssignmentDocs","trackingCalls","trackingCall","all","changeId","recordChangeId","on","off","attributeOverrides","r","variationIndex","hashUsed","bucket","stickyBucketUsed","o","fallback","urlRegex","pathOnly","expGroups","assignments","getStickyBucketAssignments","blockedKey","variationKey","findIndex","experimentKey","experimentBucketVersion","getStickyBucketAttributeKey","attributeName","attributeValue","hashKey","fallbackValue","fallbackKey","existingAssignments","newAssignments","deriveStickyBucketIdentifierAttributes","experiments","getAllStickyBucketAssignmentDocs","stickyBucketService","getStickyBucketAttributes","getAllAssignments","stickyBucketIdentifierAttributes","decryptPayload","encryptedFeatures","encryptedExperiments","encryptedSavedGroups","defaultHost","apiHostRequestHeaders","SDK_VERSION","GrowthBook","constructor","_options","context","_renderer","renderer","_trackedExperiments","_completedChangeIds","_trackedFeatures","debug","_subscriptions","ready","_assigned","_activeAutoExperiments","_triggeredExpKeys","_initialized","_redirectedUrl","_deferredTrackingCalls","_autoExperimentsAllowed","disableExperimentsOnLoad","_destroyCallbacks","logs","log","_saveDeferredTrack","_fireSubscriptions","_recordChangedId","isGbHost","hostname","_saveStickyBucketAssignmentDoc","saveAssignments","plugins","plugin","_growthbook","dispatchEvent","Event","_updateAllAutoExperiments","refreshStickyBuckets","_payload","_decryptedPayload","_render","initSync","generateStickyBucketAssignmentDocsSync","init","_refresh","loadFeatures","autoRefresh","subscribeToChanges","getFeatures","getExperiments","getDecryptedPayload","setFeatures","setEncryptedFeatures","featuresJSON","setExperiments","setEncryptedExperiments","experimentsJSON","setAttributes","_refreshForRemoteEval","updateAttributes","setAttributeOverrides","setForcedVariations","vars","setForcedFeatures","setURL","getStickyBucketAssignmentDocs","getCompletedChangeIds","getAllResults","onDestroy","isDestroyed","_destroyed","destroy","undo","setRenderer","forceVariation","run","_getEvalContext","triggerExperiment","_runAutoExperiment","triggerAutoExperiments","_getUserContext","_getGlobalContext","blockedChangeIds","_getContextUrl","forceRerun","manual","isBlocked","_isAutoExperimentBlockedByContext","valueHash","_undoActiveAutoExperiment","changeType","urlRedirect","persistQueryString","navigate","_getNavigateFunction","maxNavigateDelay","navigateDelay","applyDomChangesCallback","_applyDOMChanges","prev","isOn","isOff","getFeatureValue","_evalFeature","msg","getDeferredTrackingCalls","values","setDeferredTrackingCalls","fireDeferredTrackingCalls","promises","call","setTrackingCallback","callback","setEventLogger","logger","logEvent","eventName","properties","location","disableVisualExperiments","disableJsInjection","js","disableUrlRedirectExperiments","disableCrossOriginUrlRedirectExperiments","protocol","getRedirectUrl","changes","css","head","appendChild","remove","script","jsInjectionNonce","nonce","docs","getAllAssignmentsSync","inDevMode","StickyBucketService","opts","prefix","getAssignments","StickyBucketServiceSync","getAssignmentsSync","saveAssignmentsSync","LocalStorageStickyBucketService","raw","BrowserCookieStickyBucketService","jsCookie","cookieAttributes","expires","getBrowserDevice","ua","browser","deviceType","getURLAttributes","query","autoAttributesPlugin","settings","COOKIE_NAME","uuidCookieName","uuidKey","uuid","persistUUID","setCookie","getUUID","getCookie","genUUID","getAutoAttributes","navigator","userAgent","_uuid","uuidAutoPersist","getDataLayerVariables","pageTitle","title","getUtmAttributes","gb","currentUrl","intervalTimer","setInterval","refreshListener","clearInterval","d","COOKIE_DAYS","setTime","cookie","toUTCString","randomUUID","getRandomValues","floor","utms","sessionStorage","params","URLSearchParams","hasChanges","param","toUpperCase","slice","dataLayer","item","valueType","parseString","parseAttributes","user_id","device_id","anonymous_id","page_id","session_id","utmCampaign","utmContent","utmMedium","utmSource","utmTerm","nested","topLevel","utm_campaign","utm_content","utm_medium","utm_source","utm_term","page_title","getEventPayload","event_name","properties_json","sdk_language","sdk_version","context_json","track","ingestorHost","events","endpoint","Accept","credentials","growthbookTrackingPlugin","queueFlushInterval","enable","dedupeCacheSize","dedupeKeyAttributes","eventFilter","eventCache","_q","flush","userContext","dedupeKeyData","oldest","next","reject","prevEvents","gbEvents","thirdPartyTrackingPlugin","additionalCallback","trackers","eventParams","experiment_id","variation_id","gtag","gtagResolve","gtagPromise","event_callback","datalayerResolve","datalayerPromise","eventCallback","analytics","segmentPromise","currentScript","dataContext","dataset","windowContext","growthbook_config","antiFlickerTimeout","setAntiFlicker","timeoutMs","isFinite","getElementById","styleTag","classList","unsetAntiFlicker","antiFlicker","useStickyBucketService","stickyBucketPrefix","Cookies","noAutoCookies","tracking","toLowerCase","trim","eventIngestorHost","additionalTrackingCallback","CustomEvent","noStreaming","fireCallback","growthbook_queue"],"mappings":"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"}